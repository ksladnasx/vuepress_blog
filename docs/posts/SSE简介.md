---
date: 2025-11-24
category:
  - æ‚é¡¹
tag:
  - SSE
---

æµè§ˆå™¨SSEï¼ˆServer-Sent Eventsï¼ŒæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼‰æ˜¯ä¸€ç§åŸºäºHTTPçš„æŠ€æœ¯ï¼Œå…è®¸æœåŠ¡å™¨ä¸»åŠ¨å°†å®æ—¶æ•°æ®æ¨é€ç»™å®¢æˆ·ç«¯ï¼ˆå¦‚ç½‘é¡µæµè§ˆå™¨ï¼‰ï¼Œè€Œæ— éœ€å®¢æˆ·ç«¯åå¤è¯·æ±‚ã€‚

## SSEç®€ä»‹

### ğŸ” SSEçš„æ ¸å¿ƒç‰¹æ€§

SSEçš„æ ¸å¿ƒå·¥ä½œæœºåˆ¶æ˜¯ï¼Œå®¢æˆ·ç«¯é€šè¿‡åˆ›å»ºä¸€ä¸ª`EventSource`å¯¹è±¡ä¸æœåŠ¡å™¨å»ºç«‹æŒä¹…è¿æ¥ã€‚æœåŠ¡å™¨åˆ™é€šè¿‡å‘é€å…·æœ‰ç‰¹å®š`Content-Type: text/event-stream`å¤´ä¿¡æ¯çš„å“åº”ï¼Œæ¥ä¿æŒæ­¤è¿æ¥å¼€æ”¾å¹¶æŒç»­æ¨é€æ•°æ®

ã€‚å…¶å…³é”®ç‰¹æ€§åŒ…æ‹¬ï¼š

- 

  **å•å‘é€šä¿¡**ï¼šæ•°æ®æµåªèƒ½ä»æœåŠ¡å™¨æµå‘å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ— æ³•é€šè¿‡åŒä¸€è¿æ¥å‘æœåŠ¡å™¨å‘é€æ•°æ®

  ã€‚

- 

  **åŸºäºHTTP**ï¼šSSEæ„å»ºåœ¨æ ‡å‡†HTTPåè®®ä¹‹ä¸Šï¼Œå…¼å®¹æ€§è‰¯å¥½ï¼Œæ— éœ€åƒWebSocketé‚£æ ·å¼•å…¥æ–°çš„åè®®

  ã€‚

- 

  **è‡ªåŠ¨é‡è¿**ï¼šæµè§ˆå™¨å†…ç½®äº†è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼Œè¿æ¥æ„å¤–ä¸­æ–­æ—¶ä¼šå°è¯•é‡æ–°å»ºç«‹è¿æ¥

  ã€‚

- 

  **æ ‡å‡†æ¶ˆæ¯æ ¼å¼**ï¼šæ•°æ®æ ¼å¼ç®€å•ï¼Œé€šå¸¸ä¸ºæ–‡æœ¬ï¼ˆUTF-8ç¼–ç ï¼‰ã€‚æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯å¯åŒ…å«äº‹ä»¶ç±»å‹ï¼ˆ`event`ï¼‰ã€æ•°æ®æœ¬èº«ï¼ˆ`data`ï¼‰ã€æ¶ˆæ¯IDï¼ˆ`id`ï¼‰å’Œé‡è¿æ—¶é—´ï¼ˆ`retry`ï¼‰ç­‰å­—æ®µ

  ã€‚

### âš¡ SSEçš„è¿æ¥æ•°é™åˆ¶ä¸è§£å†³æ–¹æ¡ˆ

å…³äºæ‚¨æåˆ°çš„è¿æ¥æ•°é™åˆ¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå…³é”®ç‚¹ï¼š

- 

  **é»˜è®¤é™åˆ¶**ï¼šåœ¨**HTTP/1.1**åè®®ä¸‹ï¼Œå¤§å¤šæ•°ç°ä»£æµè§ˆå™¨ï¼ˆå¦‚Chromeã€Firefoxã€Edgeï¼‰å¯¹**åŒä¸€åŸŸåï¼ˆåè®®+åŸŸå+ç«¯å£ï¼‰çš„å¹¶å‘è¿æ¥æ•°é™åˆ¶é€šå¸¸ä¸º6ä¸ª**

  ã€‚è¿™æ„å‘³ç€ï¼ŒåŒä¸€ä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µï¼ˆæˆ–åŒä¸€æµè§ˆå™¨å®ä¾‹ï¼‰ä¸­ï¼Œå¯¹ç›¸åŒåŸŸåæœ€å¤šåªèƒ½åŒæ—¶å»ºç«‹çº¦6ä¸ªSSEè¿æ¥ï¼Œè¶…å‡ºæ­¤æ•°é‡çš„æ–°è¿æ¥ä¼šè¢«æµè§ˆå™¨é˜»å¡ï¼Œç›´åˆ°æœ‰è¿æ¥è¢«å…³é—­

  ã€‚

- 

  **é™åˆ¶åŸå› **ï¼šæ­¤é™åˆ¶æ˜¯HTTP/1.1è§„èŒƒä¸­çš„å†å²é—ç•™è®¾å®šï¼Œæ—¨åœ¨é˜²æ­¢å•ä¸ªå®¢æˆ·ç«¯è¿‡åº¦æ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œç¡®ä¿ç½‘ç»œèµ„æºå…¬å¹³åˆ†é…

  ã€‚

è‹¥æ‚¨çš„åº”ç”¨éœ€è¦çªç ´æ­¤é™åˆ¶ï¼Œå¯è€ƒè™‘ä»¥ä¸‹æ–¹æ¡ˆï¼š

| è§£å†³æ–¹æ¡ˆ              | æè¿°                                                         | é€‚ç”¨åœºæ™¯                                                     |
| :-------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| **å‡çº§è‡³HTTP/2**      | HTTP/2æ”¯æŒ**å¤šè·¯å¤ç”¨**ï¼Œå¯åœ¨å•ä¸ªTCPè¿æ¥ä¸Šå¹¶è¡Œå¤„ç†å¤šä¸ªè¯·æ±‚å’Œå“åº”ï¼Œä»è€Œä»æ ¹æœ¬ä¸Šè§£å†³è¿æ¥æ•°é™åˆ¶é—®é¢˜ã€‚ | **é•¿è¿œå’Œæ¨èæ–¹æ¡ˆ**ï¼Œéœ€æœåŠ¡å™¨å’Œæµè§ˆå™¨æ”¯æŒï¼Œé€šå¸¸è¦æ±‚ä½¿ç”¨HTTPSã€‚ |
| **å¤šåŸŸå/å¤šç«¯å£ç­–ç•¥** | å°†SSEè¿æ¥åˆ†æ•£åˆ°ä¸åŒçš„å­åŸŸï¼ˆå¦‚`sse1.example.com`, `sse2.example.com`ï¼‰æˆ–ä¸åŒç«¯å£å·ã€‚æ¯ä¸ªå­åŸŸæˆ–ç«¯å£äº«æœ‰ç‹¬ç«‹çš„6ä¸ªè¿æ¥é™é¢ã€‚ | **è¿‡æ¸¡æ–¹æ¡ˆ**ï¼Œé€‚ç”¨äºæš‚æ— æ³•å‡çº§HTTP/2çš„æƒ…å†µï¼Œä½†é…ç½®ç®¡ç†ç¨å¤æ‚ã€‚ |
| **ä¼˜åŒ–è¿æ¥ä½¿ç”¨**      | åŠæ—¶å…³é—­ä¸å†éœ€è¦çš„SSEè¿æ¥ï¼Œæˆ–å°è¯•å°†å¤šä¸ªæ•°æ®æµåˆå¹¶åˆ°ä¸€ä¸ªSSEè¿æ¥ä¸­ä¼ è¾“ï¼ˆé€šè¿‡ä¸åŒäº‹ä»¶ç±»å‹åŒºåˆ†ï¼‰ã€‚ | **åŸºç¡€ä¼˜åŒ–**ï¼Œè‰¯å¥½çš„è¿æ¥ç®¡ç†ä¹ æƒ¯ã€‚                           |

### ğŸ”„ SSEä¸WebSocketå¦‚ä½•é€‰æ‹©

SSEå¹¶éä¸‡èƒ½ï¼Œç†è§£å…¶ä¸WebSocketçš„åŒºåˆ«æœ‰åŠ©äºæ­£ç¡®é€‰å‹ï¼š

| ç‰¹æ€§         | SSE (Server-Sent Events)                     | WebSocket                      |
| :----------- | :------------------------------------------- | :----------------------------- |
| **é€šä¿¡æ¨¡å¼** | **æœåŠ¡å™¨->å®¢æˆ·ç«¯ï¼ˆå•å‘ï¼‰**                   | **å®¢æˆ·ç«¯<->æœåŠ¡å™¨ï¼ˆå…¨åŒå·¥ï¼‰**  |
| **åè®®åŸºç¡€** | HTTP                                         | ç‹¬ç«‹çš„WebSocketåè®®ï¼ˆåŸºäºTCPï¼‰ |
| **å¤æ‚åº¦**   | ç›¸å¯¹ç®€å•ï¼ŒåŸç”Ÿæ”¯æŒå¥½                         | ç›¸å¯¹å¤æ‚ï¼Œå¸¸éœ€åº“æ”¯æŒ           |
| **æ–­çº¿é‡è¿** | **åŸç”Ÿæ”¯æŒè‡ªåŠ¨é‡è¿**                         | éœ€æ‰‹åŠ¨å®ç°                     |
| **æ•°æ®ä¼ è¾“** | ä»…æ–‡æœ¬ï¼ˆUTF-8ï¼‰                              | æ–‡æœ¬å’ŒäºŒè¿›åˆ¶æ•°æ®               |
| **å…¸å‹åœºæ™¯** | å®æ—¶æ–°é—»æ¨é€ã€è‚¡ä»·æ›´æ–°ã€ç³»ç»Ÿé€šçŸ¥ã€ç›‘æ§ä»ªè¡¨ç›˜ | åœ¨çº¿èŠå¤©å®¤ã€å®æ—¶æ¸¸æˆã€ååŒç¼–è¾‘ |

ç®€å•æ¥è¯´ï¼Œè‹¥æ‚¨çš„åº”ç”¨åœºæ™¯ä¸»è¦æ˜¯æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å•å‘æ¨é€æ•°æ®ï¼ŒSSEå› å…¶ç®€å•æ€§å’Œè‡ªåŠ¨é‡è¿ç­‰ç‰¹æ€§é€šå¸¸æ˜¯æ›´è½»é‡ã€ä¾¿æ·çš„é€‰æ‹©ã€‚è‹¥éœ€è¦é¢‘ç¹çš„åŒå‘äº¤äº’ï¼Œåˆ™WebSocketæ›´åˆé€‚ã€‚

## ä»£ç æµç¨‹

# SSEç®€å•ç¤ºä¾‹ï¼šVue3å‰ç«¯ + Node.jsåç«¯

## åç«¯å…³é”®ä»£ç  (Node.js)

```js
const express = require('express');
const app = express();

// å­˜å‚¨è¿æ¥çš„å®¢æˆ·ç«¯
const clients = [];

// SSEç«¯ç‚¹
app.get('/sse', (req, res) => {
  res.writeHead(200, {
    'Content-Type': 'text/event-stream',
    'Cache-Control': 'no-cache',
    'Connection': 'keep-alive',
  });

  // å°†å®¢æˆ·ç«¯åŠ å…¥åˆ—è¡¨
  clients.push(res);

  // å‘é€è¿æ¥æˆåŠŸæ¶ˆæ¯
  res.write('data: è¿æ¥æˆåŠŸ\n\n');

  // å®šæ—¶å‘é€æ¶ˆæ¯
  const interval = setInterval(() => {
    res.write(`data: æœåŠ¡å™¨æ—¶é—´: ${new Date().toISOString()}\n\n`);
  }, 3000);

  // å®¢æˆ·ç«¯æ–­å¼€è¿æ¥æ—¶æ¸…ç†
  req.on('close', () => {
    clearInterval(interval);
    const index = clients.indexOf(res);
    if (index !== -1) clients.splice(index, 1);
  });
});

app.listen(3000, () => console.log('Server running on port 3000'));
```

## å‰ç«¯å…³é”®ä»£ç  (Vue3)

```vue
<template>
  <div>
    <h2>SSEç¤ºä¾‹</h2>
    <button @click="connect">è¿æ¥</button>
    <button @click="disconnect">æ–­å¼€</button>
    <div>
      <p v-for="(msg, index) in messages" :key="index">{{ msg }}</p>
    </div>
  </div>
</template>

<script setup>
import { ref, onUnmounted } from 'vue';

const messages = ref([]);
let eventSource = null;

const connect = () => {
  // åˆ›å»ºSSEè¿æ¥
  eventSource = new EventSource('http://localhost:3000/sse');
  
  eventSource.onmessage = (event) => {
    messages.value.push(event.data);
  };
  
  eventSource.onerror = (error) => {
    console.error('SSEé”™è¯¯:', error);
  };
};

const disconnect = () => {
  if (eventSource) {
    eventSource.close();
    eventSource = null;
  }
};

// ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ–­å¼€è¿æ¥
onUnmounted(() => {
  disconnect();
});
</script>
```

## è¿è¡Œæ­¥éª¤

1. **åç«¯**ï¼š

```cmd
npm install express
node server.js
```

1. **å‰ç«¯**ï¼š

```cmd
npm create vue@latest
# å°†ä¸Šé¢çš„Vueä»£ç æ”¾å…¥ç»„ä»¶
npm run dev
```

è¿™ä¸ªç®€å•ç¤ºä¾‹å±•ç¤ºäº†SSEçš„æ ¸å¿ƒåŠŸèƒ½ï¼š

- åç«¯å»ºç«‹SSEè¿æ¥å¹¶å®šæ—¶æ¨é€æ¶ˆæ¯
- å‰ç«¯è¿æ¥SSEå¹¶å®æ—¶æ˜¾ç¤ºæ¶ˆæ¯
- åŸºæœ¬çš„è¿æ¥/æ–­å¼€æ§åˆ¶
