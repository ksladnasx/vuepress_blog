---
date: 2025-01-05
category:
  - 期末复习
tag:
  - 软件定义网络
---

## **一、概述**

1. **传统网络的局限**：
   - 配置复杂、设备依赖厂商、网络策略分散、难以灵活调整。
2. **SDN能解决的问题及解决方式**：
   - **控制与转发分离**：通过集中控制器管理转发设备。
   - **集中控制**：统一策略下发，简化管理。
   - **开放可编程**：通过开放接口实现网络功能自定义。

---

## **二、SDN基本原理**

0. CDPI (Control Data Path Interface)
1. NBI (北向接口代理)

1. **三层架构**：
   - 应用层：包含网络承载的多元业务与应用，通过调用控制层提供的接口实现网络应用的运行（如防火墙、负载均衡）。
   - 控制层：通过API为上层提供可编程接口，另一方面通过CDPI对基础设施层的网络设备进行统一的配置管理与控制。
   - 基础设施层：底层交换机等基础设施，通过CDPI接收来自控制器的指令完成网络数据包处理，同时借此接口反馈网络的配置和运行状态。
2. **四大平面**：
   - 数据平面：若干网元构成，一个网元包含一个或多个SDN Datapath （逻辑上的网络设备），负责数据或流的转发和处理。
   - 控制平面：包括北向接口代理(NBI)，SDN控制逻辑和CDPI(数据平面接口驱动)，一方面通过NBI实现从北向南的应用需求发布和从南向北的底层网络反馈，另一方面依托CDPI将应用层需求以SDN转发规则的形式发送到数据通路，以及从数据平面获取网元的运行状态和事件反馈信息。
   - 管理平面：负责网元的初始化配置，指定SDN Datapath控制器，定义SDN控制器以及应用的控制范畴等静态工作。
   - 应用平面：包括SDN应用逻辑和北向接口驱动，通过北向接口与控制器交互，实现网络应用和业务逻辑。
3. **两大接口**：
   - 南向接口：控制器与交换机通信（如OpenFlow）。
   - 北向接口：应用与控制器通信（如REST API）。
4. **重要属性**：
   - 集中控制、开放接口、可编程性、协议无关。
5. **SDN的思想与好处**：
   - 思想：解耦、集中智能、软件定义。
   - 好处：灵活部署、自动化运维、促进创新。

---

## **三、SDN数据平面**
1. **OVS交换机组成**：

   - 内核模块（datapath）：快速转发。
   - 用户空间守护进程（ovs-vswitchd）：管理流表。

2. **OpenFlow交换机组成**

   - 流表：由若干流表项构成，每个动作关联一个流表项，指示交换机如何进行流的处理。

   - 安全通道：负责控制器与交换机之间的交互，OpenFlow交换机通过安全通道与远程控制器连接。
   - OpenFlow协议: 定义了一种南向接口标准，为控制器与交换机之间的通信提供了一种开放的标准。

3. **流表 vs 传统转发表**：

   - 流表：指特定流的转发策略表项的集合，是OpenFlow交换机中对数据转发逻辑的抽象。包含多字段匹配（涵盖OSI模型的2-4层网络特征），且支持动作集。
   - 传统转发表：通常只基于目的地址。

4. **动作**：匹配后执行的操作（如转发、丢弃、修改字段）。

5. **PISA实现协议无关**：

   - 通过可编程解析器定义报文格式，匹配动作表可配置。

6. **P4组件**：

   - 解析器、匹配动作表、逆解析器、控制器API。

7. **重要Mininet指令**：
   - `mn`：创建拓扑
   - `pingall`：测试连通性
   - `net`：查看链路
   - `dpctl`：操作流表

8. **流表分析实例**：
   - 例如：`priority=10,ip,nw_dst=10.0.0.1,actions=output:1`
   - 表示：匹配IP目的地址为10.0.0.1的包，从端口1转发。

9. **传统 vs SDN数据平面**：
   - 传统：固定功能、硬件依赖。
   - SDN：可编程、灵活匹配。

10. **OpenFlow保留端口**：
   - 如 `CONTROLLER`、`LOCAL`、`ALL`、`IN_PORT` 等。

---

## **四、南向接口协议**
1. **概念与设计目标**：
   - 标准化控制器与数据层通信，实现开放与可编程。核心需求是**标准化、可扩展、支持集中控制**
2. **常见协议**：
   - **OpenFlow**：基于流表的转发控制。
   - **NETCONF**：基于XML的网络配置管理。
   - **OVSDB**：管理OVS交换机数据库。
3. **协议间联系**：
   - OpenFlow 负责转发控制，NETCONF 负责配置管理，常结合使用。
4. **OpenFlow消息类型**：
   - Controller-to-Switch：`Features`（  控制器获取交换机特性）、`Flow-mod`（增 / 删 / 改交换机流表项）、`Packet-out`（控制器指导交换机转发数据包）
   - Asynchronous（异步）：`Packet-in`（新数据包在流表中没有匹配项或者匹配项指定端口为Controller的动作时才发送）、`Flow-removed`（流表项因超时 / 修改被控制器删除）、`Port-status`（上报端口状态变化（Up/Down））
   - Symmetric：Hello（协议版本协商），Echo（保活检测）
5. **OpenFlow通信流程**：
   - 交换机与控制器建立 TCP 连接，交换 Hello 消息协商协议版本。
   - 控制器发送 Features-request 消息，获取交换机特性（流表数、端口）。
   - 控制器用Get-config 获取交换机全局参数信息，下发 Set-config 消息配置交换机全局参数（并非配置转发规则）（可选）。
   - 正常通信：交换机上报 Packet-in/Port-status 消息，控制器下发 Flow-mod/Packet-out 消息。
   - 连接维护：通过 Echo 消息保活，异常时触发重连。
6. **NETCONF**：
   - `<hello>`、`<rpc>`、`<rpc-reply>`、`<notification>`。
   - 三个配置数据库间的逻辑：你可以通过`<get-config>`在候选配置数据库上进行配置，配置确认后利用`<commit>`功能提交到Running数据库，最后还可以将Running数据库中的配置利用`<copy-config>`复制配置到startup数据库以便重启后加载。

---

## **五、SDN控制平面**
1. **控制平面架构**：
   - 集中式、分布式、混合式。
2. **控制器基础功能**：
   - 拓扑发现、路由计算、流表下发、状态监控。
3. **链路发现流程**：
   - 控制器通过LLDP包发现交换机及其连接关系。
4. **Pox控制器**：
   - 组件：`openflow.of_01`、`topology`、`host_tracker`
   - 启动：`python pox.py forwarding.l2_learning`
   - 优点：简单易上手；缺点：性能差，功能有限。
5. **Pox二层自学习流程**：
   - 收到包 → 学习源MAC → 查找目的MAC → 转发或广播。
6. **Ryu控制器**：
   - 组件：`app_manager`、`ofp_handler`、`event`
   - 运行框架：事件驱动，支持多应用。
   - 优点：功能丰富，适合开发；缺点：学习曲线陡。
7. **Ryu二层交换涉及OF消息**：
   - `Packet-in`、`Packet-out`、`Flow-mod`。
8. **Ryu常见curl指令**：
   - `curl http://localhost:8080/v1.0/switches`

---

## **六、SDN北向接口**
1. **功能**：
   - 为上层应用提供网络控制与状态查询接口。
2. **常见协议**：
   - **REST API**：基于HTTP，轻量易用。
   - **RESTCONF**：基于HTTP/JSON/YANG，配置管理。
   - **NETCONF**：也可作为北向接口。
3. **URI标准化格式**：
   - `http://<controller>:<port>/<api_version>/<resource>`
4. **Ryu REST API示例**：
   - `GET /v1.0/switches` 获取交换机列表。
5. **RESTCONF vs NETCONF**：
   - RESTCONF：轻量、基于HTTP，适合Web开发。
   - NETCONF：功能强、基于XML，适合配置管理。
6. **RESTCONF查询参数**：
   - `fields`、`depth`、`filter`、`content`。

---

## **七、应用篇**
- **答题思路**：
  - 围绕 **集中控制**、**开放接口**、**可编程性** 展开。
  - 举例：网络虚拟化、流量工程、安全策略集中管理、自动化运维。

---

## **八、实验重点知识**
- **实验五：流表分析与消息解析**
  - 使用 `ovs-ofctl dump-flows` 查看流表。
  - 解析 `Packet-in` 消息：包含入端口、包数据、缓冲区ID等。
  - 解析 `Flow-mod` 消息：包含匹配字段、动作、优先级等。
