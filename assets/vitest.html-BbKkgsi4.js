import{_ as s,c as a,a as t,o as p}from"./app-UmXydJji.js";const e={};function c(l,n){return p(),a("div",null,[...n[0]||(n[0]=[t(`<h1 id="vitestå…¥é—¨" tabindex="-1"><a class="header-anchor" href="#vitestå…¥é—¨"><span>Vitestå…¥é—¨</span></a></h1><h2 id="åŸºæœ¬æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#åŸºæœ¬æµ‹è¯•"><span>åŸºæœ¬æµ‹è¯•</span></a></h2><h3 id="ğŸ“-ç†è§£æµ‹è¯•æ–‡ä»¶çš„åŸºæœ¬ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ğŸ“-ç†è§£æµ‹è¯•æ–‡ä»¶çš„åŸºæœ¬ç»“æ„"><span>ğŸ“ ç†è§£æµ‹è¯•æ–‡ä»¶çš„åŸºæœ¬ç»“æ„</span></a></h3><p>ä¸€ä¸ª Vitest æµ‹è¯•æ–‡ä»¶é€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒä»¬å…±åŒæ„æˆäº†æµ‹è¯•çš„åŸºæœ¬éª¨æ¶ï¼š</p><table><thead><tr><th>ç»„æˆéƒ¨åˆ†</th><th>æè¿°</th><th>ä»£ç ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>å¯¼å…¥è¯­å¥</strong></td><td>å¼•å…¥æµ‹è¯•æ¡†æ¶çš„åŠŸèƒ½å’Œå¾…æµ‹è¯•å¯¹è±¡ã€‚</td><td><code>import { describe, it, expect } from &#39;vitest&#39;;\`\`import { sum } from &#39;./math&#39;;</code></td></tr><tr><td><strong>æµ‹è¯•å¥—ä»¶ (Test Suite)</strong></td><td>ä½¿ç”¨ <code>describe</code>å°†ä¸€ç³»åˆ—ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹ç»„ç»‡åœ¨ä¸€èµ·ã€‚</td><td><code>describe(&#39;æ•°å­¦å·¥å…·å‡½æ•°&#39;, () =&gt; { ... });</code></td></tr><tr><td><strong>æµ‹è¯•ç”¨ä¾‹ (Test Case)</strong></td><td>ä½¿ç”¨ <code>it</code>æˆ– <code>test</code>å®šä¹‰å•ä¸ªå…·ä½“çš„æµ‹è¯•åœºæ™¯ã€‚</td><td><code>it(&#39;åº”è¯¥èƒ½æ­£ç¡®è®¡ç®—ä¸¤ä¸ªæ•°å­—çš„å’Œ&#39;, () =&gt; { ... });</code></td></tr><tr><td><strong>æ–­è¨€ (Assertion)</strong></td><td>ä½¿ç”¨ <code>expect</code>æ¥éªŒè¯ä»£ç çš„è¡Œä¸ºå’Œè¾“å‡ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</td><td><code>expect(sum(1, 2)).toBe(3);</code></td></tr></tbody></table><p>ä¸€ä¸ªå®Œæ•´çš„ç®€å•æµ‹è¯•ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// å¯¼å…¥</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> sum <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../src/utils/math&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ç»„ç»‡æµ‹è¯•å¥—ä»¶</span></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;æ•°å­¦å·¥å…·å‡½æ•°&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// å®šä¹‰æµ‹è¯•ç”¨ä¾‹</span></span>
<span class="line">  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;sum å‡½æ•°&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;åº”è¯¥èƒ½æ­£ç¡®è®¡ç®—ä¸¤ä¸ªæ•°å­—çš„å’Œ&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// å‡†å¤‡æ•°æ® (Arrange)</span></span>
<span class="line">      <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// æ‰§è¡Œå‡½æ•° (Act)</span></span>
<span class="line">      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// éªŒè¯ç»“æœ (Assert)</span></span>
<span class="line">      <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–­è¨€</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™ä¸ªç»å…¸çš„ <strong>Arrange-Act-Assert</strong>(å‡†å¤‡-æ‰§è¡Œ-æ–­è¨€) æ¨¡å¼èƒ½è®©ä½ çš„æµ‹è¯•é€»è¾‘éå¸¸æ¸…æ™°ã€‚</p><h3 id="ğŸ¯-æŒæ¡æ ¸å¿ƒæ–­è¨€æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-æŒæ¡æ ¸å¿ƒæ–­è¨€æ–¹æ³•"><span>ğŸ¯ æŒæ¡æ ¸å¿ƒæ–­è¨€æ–¹æ³•</span></a></h3><p>æ–­è¨€æ˜¯æµ‹è¯•çš„çµé­‚ï¼ŒVitest æä¾›äº†ä¸°å¯Œå¤šæ ·çš„åŒ¹é…å™¨ï¼ˆMatcherï¼‰æ¥æ»¡è¶³å„ç§éªŒè¯éœ€æ±‚ã€‚</p><table><thead><tr><th>æ–­è¨€ç›®çš„</th><th>å¸¸ç”¨åŒ¹é…å™¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><strong>ç›¸ç­‰æ€§åˆ¤æ–­</strong></td><td><code>.toBe()</code>, <code>.toEqual()</code></td><td><code>expect(2 + 2).toBe(4);\`\`expect({a: 1}).toEqual({a: 1});</code></td></tr><tr><td><strong>çœŸå®æ€§åˆ¤æ–­</strong></td><td><code>.toBeTruthy()</code>, <code>.toBeFalsy()</code>, <code>.toBeNull()</code>, <code>.toBeUndefined()</code></td><td><code>expect(&#39;&#39;).toBeFalsy();\`\`expect(null).toBeNull();</code></td></tr><tr><td><strong>æ•°å€¼æ¯”è¾ƒ</strong></td><td><code>.toBeGreaterThan()</code>, <code>.toBeLessThanOrEqual()</code></td><td><code>expect(10).toBeGreaterThan(5);</code></td></tr><tr><td><strong>å­—ç¬¦ä¸²åŒ¹é…</strong></td><td><code>.toContain()</code>, <code>.toMatch()</code></td><td><code>expect(&#39;Hello Vitest&#39;).toContain(&#39;Vitest&#39;);</code></td></tr><tr><td><strong>æ•°ç»„æˆ–è¿­ä»£å¯¹è±¡</strong></td><td><code>.toContain()</code>, <code>.toHaveLength()</code></td><td><code>expect([1, 2, 3]).toContain(2);\`\`expect(array).toHaveLength(3);</code></td></tr><tr><td><strong>å¼‚å¸¸æŠ›å‡º</strong></td><td><code>.toThrow()</code></td><td><code>expect(() =&gt; { throwError(); }).toThrow();</code></td></tr><tr><td><strong>å¯¹è±¡å±æ€§</strong></td><td><code>.toHaveProperty()</code></td><td><code>expect(obj).toHaveProperty(&#39;key&#39;, &#39;value&#39;);</code></td></tr></tbody></table><h3 id="ğŸ”§-ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ç»„ç»‡æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ç»„ç»‡æµ‹è¯•"><span>ğŸ”§ ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ç»„ç»‡æµ‹è¯•</span></a></h3><p>å¯¹äºå¤æ‚çš„æµ‹è¯•åœºæ™¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­æ¥è®¾ç½®æµ‹è¯•ç¯å¢ƒå’Œæ¸…ç†èµ„æºï¼Œè¿™ç±»ä¼¼äº Vue ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> beforeAll<span class="token punctuation">,</span> beforeEach<span class="token punctuation">,</span> afterEach<span class="token punctuation">,</span> afterAll<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> it <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;æµ‹è¯•ç”¨æˆ·ç®¡ç†æ¨¡å—&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> userService<span class="token punctuation">;</span> <span class="token comment">// å£°æ˜å˜é‡ï¼Œä¾›æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// åœ¨æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹è¿è¡Œä¹‹å‰æ‰§è¡Œä¸€æ¬¡ï¼Œå¸¸ç”¨äºåˆå§‹åŒ–å…¨å±€èµ„æº</span></span>
<span class="line">  <span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å¼€å§‹è¿è¡Œç”¨æˆ·ç®¡ç†æ¨¡å—æµ‹è¯•...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// ä¾‹å¦‚ï¼Œåˆå§‹åŒ–æ•°æ®åº“è¿æ¥</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// åœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è¿è¡Œä¹‹å‰æ‰§è¡Œï¼Œå¸¸ç”¨äºé‡ç½®çŠ¶æ€</span></span>
<span class="line">  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä¸ºæ¯ä¸ªæµ‹è¯•åˆ›å»ºä¸€ä¸ªå¹²å‡€çš„å®ä¾‹</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// åœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è¿è¡Œä¹‹åæ‰§è¡Œï¼Œå¸¸ç”¨äºæ¸…ç†</span></span>
<span class="line">  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    userService<span class="token punctuation">.</span><span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ¸…ç†æµ‹è¯•äº§ç”Ÿçš„æ•°æ®</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// åœ¨æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹è¿è¡Œä¹‹åæ‰§è¡Œä¸€æ¬¡ï¼Œå¸¸ç”¨äºé‡Šæ”¾èµ„æº</span></span>
<span class="line">  <span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ç”¨æˆ·ç®¡ç†æ¨¡å—æµ‹è¯•ç»“æŸã€‚&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// ä¾‹å¦‚ï¼Œå…³é—­æ•°æ®åº“è¿æ¥</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;åº”è¯¥èƒ½åˆ›å»ºæ–°ç”¨æˆ·&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// è¿™é‡Œçš„ userService æ˜¯ beforeEach ä¸­æ–°å»ºçš„å®ä¾‹</span></span>
<span class="line">    <span class="token keyword">const</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;Alice&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;Alice&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;ä¸åº”è¯¥åˆ›å»ºé‡åç”¨æˆ·&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    userService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;Bob&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> userService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&#39;Bob&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ğŸ­-æ¨¡æ‹Ÿ-mock-å¤–éƒ¨ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#ğŸ­-æ¨¡æ‹Ÿ-mock-å¤–éƒ¨ä¾èµ–"><span>ğŸ­ æ¨¡æ‹Ÿï¼ˆMockï¼‰å¤–éƒ¨ä¾èµ–</span></a></h3><p>æ¨¡æ‹Ÿæ˜¯å•å…ƒæµ‹è¯•çš„å…³é”®æŠ€æœ¯ï¼Œç”¨äºéš”ç¦»è¢«æµ‹ä»£ç ã€‚Vitest æä¾›äº†å¼ºå¤§çš„ <code>vi</code>å·¥å…·è¿›è¡Œæ¨¡æ‹Ÿã€‚</p><p><strong>1. æ¨¡æ‹Ÿä¸€ä¸ªå‡½æ•°</strong></p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> vi<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ¨¡æ‹Ÿä¸€ä¸ªå‡½æ•°</span></span>
<span class="line"><span class="token keyword">const</span> fetchData <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºä¸€ä¸ªç©ºçš„æ¨¡æ‹Ÿå‡½æ•°</span></span>
<span class="line"><span class="token comment">// è®¾ç½®æ¨¡æ‹Ÿå‡½æ•°çš„è¿”å›å€¼</span></span>
<span class="line">fetchData<span class="token punctuation">.</span><span class="token function">mockReturnValueOnce</span><span class="token punctuation">(</span><span class="token string">&#39;mock data&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ä»…æ¨¡æ‹Ÿä¸€æ¬¡è¿”å›å€¼</span></span>
<span class="line"></span>
<span class="line"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;æ¨¡æ‹Ÿå‡½æ•°è°ƒç”¨&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">expect</span><span class="token punctuation">(</span>fetchData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–­è¨€å‡½æ•°è¢«è°ƒç”¨</span></span>
<span class="line">  <span class="token function">expect</span><span class="token punctuation">(</span>fetchData<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–­è¨€è°ƒç”¨æ¬¡æ•°</span></span>
<span class="line">  <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;mock data&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. æ¨¡æ‹Ÿæ•´ä¸ªæ¨¡å—ï¼ˆä¾‹å¦‚ axiosï¼‰</strong></p><p>å½“ä½ çš„ä»£ç è°ƒç”¨ API æ—¶ï¼Œä½ è‚¯å®šä¸å¸Œæœ›æµ‹è¯•çœŸçš„å»å‘é€ç½‘ç»œè¯·æ±‚ã€‚è¿™æ—¶å¯ä»¥æ¨¡æ‹Ÿæ•´ä¸ª <code>axios</code>æ¨¡å—ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// api.test.ts</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> vi<span class="token punctuation">,</span> beforeEach <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./api&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// å‘Šè¯‰ Vitest æ¨¡æ‹Ÿ axios æ¨¡å—</span></span>
<span class="line">vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#39;axios&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;API æ¨¡å—&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// åœ¨æ¯ä¸ªæµ‹è¯•å‰é‡ç½®æ‰€æœ‰æ¨¡æ‹Ÿï¼Œé¿å…æµ‹è¯•é—´ç›¸äº’å½±å“</span></span>
<span class="line">    vi<span class="token punctuation">.</span><span class="token function">resetAllMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;æˆåŠŸè·å–ç”¨æˆ·æ•°æ®&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1. å‡†å¤‡æ¨¡æ‹Ÿæ•°æ®</span></span>
<span class="line">    <span class="token keyword">const</span> mockUser <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&#39;John Doe&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// 2. è®¾ç½® axios.get æ–¹æ³•åœ¨è¢«è°ƒç”¨æ—¶è¿”å›æ¨¡æ‹Ÿæ•°æ®</span></span>
<span class="line">    axios<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token operator">:</span> mockUser <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 3. æ‰§è¡Œè¢«æµ‹å‡½æ•°</span></span>
<span class="line">    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 4. æ–­è¨€å‡½æ•°è¿”å›äº†æ­£ç¡®æ•°æ®ï¼Œå¹¶ä¸” axios.get è¢«ä»¥æ­£ç¡®çš„å‚æ•°è°ƒç”¨</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span>mockUser<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span>get<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">&#39;/users/1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;å¤„ç† API è¯·æ±‚å¤±è´¥&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ¨¡æ‹Ÿè¯·æ±‚å¤±è´¥</span></span>
<span class="line">    <span class="token keyword">const</span> errorMessage <span class="token operator">=</span> <span class="token string">&#39;Network Error&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    axios<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockRejectedValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// æ–­è¨€å‡½æ•°æŠ›å‡ºäº†é”™è¯¯</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span>errorMessage<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ğŸ’¡-æµ‹è¯•-vue-å•æ–‡ä»¶ç»„ä»¶-sfc" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-æµ‹è¯•-vue-å•æ–‡ä»¶ç»„ä»¶-sfc"><span>ğŸ’¡ æµ‹è¯• Vue å•æ–‡ä»¶ç»„ä»¶ (SFC)</span></a></h3><p>å¯¹äº Vue ç»„ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>@vue/test-utils</code>æ¥æŒ‚è½½å’Œäº¤äº’ã€‚æ ¸å¿ƒæ€è·¯æ˜¯ï¼šæ¸²æŸ“ç»„ä»¶ã€æŸ¥æ‰¾å…ƒç´ ã€æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’ã€æ–­è¨€æ¸²æŸ“ç»“æœå’Œäº‹ä»¶ã€‚</p><div class="language-vue line-numbers-mode" data-highlighter="prismjs" data-ext="vue"><pre><code><span class="line"><span class="token comment">&lt;!-- Counter.vue --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">data-testid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>å½“å‰è®¡æ•°: {{ count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>increment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>å¢åŠ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>decrement<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>å‡å°‘<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value<span class="token operator">--</span><span class="token punctuation">;</span></span>
<span class="line"></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// Counter.test.ts</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vue/test-utils&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">&#39;./Counter.vue&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;Counter.vue&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;æ¸²æŸ“åˆå§‹è®¡æ•°ä¸º 0&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// é€šè¿‡é€‰æ‹©å™¨æˆ– testid æŸ¥æ‰¾å…ƒç´ å¹¶æ–­è¨€å…¶æ–‡æœ¬å†…å®¹</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;[data-testid=&quot;count&quot;]&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">&#39;å½“å‰è®¡æ•°: 0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;ç‚¹å‡»å¢åŠ æŒ‰é’®åè®¡æ•°åŠ ä¸€&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// æ‰¾åˆ°æŒ‰é’®å¹¶è§¦å‘ç‚¹å‡»äº‹ä»¶</span></span>
<span class="line">    <span class="token keyword">await</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;button:contains(&quot;å¢åŠ &quot;)&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// æ–­è¨€è®¡æ•°æ›´æ–°</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;[data-testid=&quot;count&quot;]&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">&#39;å½“å‰è®¡æ•°: 1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;ç‚¹å‡»å‡å°‘æŒ‰é’®åè®¡æ•°å‡ä¸€&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>Counter<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// å…ˆç‚¹å‡»ä¸€æ¬¡å¢åŠ ï¼Œè®©è®¡æ•°å˜ä¸º1</span></span>
<span class="line">    <span class="token keyword">await</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;button:contains(&quot;å¢åŠ &quot;)&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// å†ç‚¹å‡»å‡å°‘</span></span>
<span class="line">    <span class="token keyword">await</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;button:contains(&quot;å‡å°‘&quot;)&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&#39;[data-testid=&quot;count&quot;]&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">&#39;å½“å‰è®¡æ•°: 0&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ğŸš€-å®è·µå·¥ä½œæµä¸å»ºè®®" tabindex="-1"><a class="header-anchor" href="#ğŸš€-å®è·µå·¥ä½œæµä¸å»ºè®®"><span>ğŸš€ å®è·µå·¥ä½œæµä¸å»ºè®®</span></a></h3><ol><li><strong>ç»„ç»‡æµ‹è¯•æ–‡ä»¶</strong>ï¼šé€šå¸¸å°†æµ‹è¯•æ–‡ä»¶æ”¾åœ¨ä¸è¢«æµ‹ä»£ç ç›¸é‚»çš„ <code>__tests__</code>ç›®å½•ä¸‹ï¼Œæˆ–ä½¿ç”¨ <code>.test.ts</code>/<code>.spec.ts</code>åç¼€ã€‚</li><li><strong>è¿è¡Œæµ‹è¯•</strong>ï¼šåœ¨ <code>package.json</code>ä¸­é…ç½®è„šæœ¬ <code>&quot;test&quot;: &quot;vitest&quot;</code>ï¼Œç„¶åä½¿ç”¨ <code>npm run test</code>è¿è¡Œã€‚æ·»åŠ  <code>--watch</code>å‚æ•°å¯ä»¥è¿›å…¥ç›‘å¬æ¨¡å¼ï¼Œå½“æ–‡ä»¶æ”¹å˜æ—¶è‡ªåŠ¨é‡æ–°è¿è¡Œæµ‹è¯•ã€‚</li><li><strong>æŸ¥çœ‹è¦†ç›–ç‡</strong>ï¼šå®‰è£…é…ç½®è¦†ç›–ç‡å·¥å…·ï¼ˆå¦‚ <code>@vitest/coverage-v8</code>ï¼‰ï¼Œè¿è¡Œ <code>vitest run --coverage</code>å¯ä»¥ç”Ÿæˆè¯¦ç»†çš„è¦†ç›–ç‡æŠ¥å‘Šï¼Œå¸®åŠ©ä½ è¯†åˆ«æœªæµ‹è¯•çš„ä»£ç ã€‚</li></ol><h2 id="ç¤ºä¾‹æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹æ–‡ä»¶"><span>ç¤ºä¾‹æ–‡ä»¶</span></a></h2><p>è¿™é‡Œå¯¹ä¸Šå‘¨çš„echartå›¾è¡¨ç»„ä»¶è¿›è¡Œæµ‹è¯•</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// tests/SalesChart.test.ts</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> vi<span class="token punctuation">,</span> beforeEach<span class="token punctuation">,</span> afterEach <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vitest&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/test-utils&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> SalesChart <span class="token keyword">from</span> <span class="token string">&quot;/src/views/SalesChart.vue&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// å®Œæ•´æ¨¡æ‹Ÿechartsæ¨¡å—</span></span>
<span class="line">vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&quot;echarts&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">    init<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      setOption<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      resize<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      dispose<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      on<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      off<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&quot;SalesChart.vue - åŸºç¡€æµ‹è¯•&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> wrapper<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">let</span> mockChartInstance<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">//è¿ç”¨  beforeEachå’Œ afterEachè¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œè¿™æ˜¯ä¿è¯æµ‹è¯•ç‹¬ç«‹æ€§çš„å…³é”®</span></span>
<span class="line">  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// åœ¨æ¯ä¸ªæµ‹è¯•å‰é‡ç½®æ‰€æœ‰mockï¼Œè¿™æ˜¯å…³é”®ï¼æ¸…ç†æ‰€æœ‰æ¨¡æ‹Ÿï¼Œç¡®ä¿æµ‹è¯•é—´äº’ä¸å¹²æ‰°</span></span>
<span class="line">    vi<span class="token punctuation">.</span><span class="token function">clearAllMocks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// åˆ›å»ºæ–°çš„æ¨¡æ‹Ÿå®ä¾‹ï¼ˆä½¿ç”¨ vi.mockæ¨¡æ‹Ÿ echartsåº“ï¼‰</span></span>
<span class="line">    <span class="token keyword">const</span> echarts <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;echarts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    mockChartInstance <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">      setOption<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      resize<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      dispose<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token comment">// æ·»åŠ å…¶ä»–å¯èƒ½ç”¨åˆ°çš„echartsæ–¹æ³•</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    vi<span class="token punctuation">.</span><span class="token function">mocked</span><span class="token punctuation">(</span>echarts<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockReturnValue</span><span class="token punctuation">(</span>mockChartInstance<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">//2. æŒ‚è½½ç»„ä»¶ï¼Œè·å¾—æ“ä½œå’ŒæŸ¥è¯¢çš„å…¥å£ï¼Œæ³¨æ„æ¯æ¬¡æµ‹è¯•åªæŒ‚è½½ä¸€æ¬¡ç»„ä»¶</span></span>
<span class="line">    wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>SalesChart<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ä½¿ç”¨æ›´å¯é çš„ç­‰å¾…æ–¹å¼</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ç¡®ä¿æ¯æ¬¡æµ‹è¯•åæ¸…ç†</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      wrapper<span class="token punctuation">.</span><span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ–­è¨€æ’°å†™</span></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;åº”è¯¥æ­£ç¡®æ¸²æŸ“å‡ºå›¾è¡¨å®¹å™¨å’Œæ ‡é¢˜&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;.chart-container&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;h2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&quot;é”€å”®æ•°æ®ç»Ÿè®¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;.chart&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;ä½¿ç”¨é»˜è®¤æ•°æ®æ—¶åº”è¯¥åˆå§‹åŒ–å›¾è¡¨&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> echarts <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;echarts&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// ç°åœ¨åº”è¯¥åªè¢«è°ƒç”¨ä¸€æ¬¡</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>echarts<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>mockChartInstance<span class="token punctuation">.</span>setOption<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// æµ‹è¯•ç»„ä»¶çš„å“åº”å¼æ›´æ–°</span></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;å½“chartDataå±æ€§å˜åŒ–æ—¶åº”è¯¥æ›´æ–°å›¾è¡¨&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// é‡ç½®è°ƒç”¨è®¡æ•°ï¼Œåªè®¡ç®—æ›´æ–°æ—¶çš„è°ƒç”¨</span></span>
<span class="line">    mockChartInstance<span class="token punctuation">.</span>setOption<span class="token punctuation">.</span><span class="token function">mockClear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// æ›´æ–°chartDataå±æ€§,å°†å…¶å˜ä¸ºåªæœ‰ä¸‰ä¸ªæ•°æ®ç‚¹çš„æ•°ç»„ï¼Œæ˜¯ä¸ºäº†æµ‹è¯•æ›´æ–°é€»è¾‘</span></span>
<span class="line">    <span class="token keyword">await</span> wrapper<span class="token punctuation">.</span><span class="token function">setProps</span><span class="token punctuation">(</span><span class="token punctuation">{</span> chartData<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">//åªè°ƒç”¨ä¸€æ¬¡</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>mockChartInstance<span class="token punctuation">.</span>setOption<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>mockChartInstance<span class="token punctuation">.</span>setOption<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      series<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="apiè¯¦è§£" tabindex="-1"><a class="header-anchor" href="#apiè¯¦è§£"><span>Apiè¯¦è§£</span></a></h1><h2 id="config" tabindex="-1"><a class="header-anchor" href="#config"><span>Config</span></a></h2><p>é…ç½®ä¿¡æ¯è¯¦è§£</p><p>Vitest çš„é…ç½®æ˜¯å…¶å¼ºå¤§åŠŸèƒ½çš„æ ¸å¿ƒï¼Œæ­£ç¡®çš„é…ç½®èƒ½æ˜¾è‘—æå‡æµ‹è¯•æ•ˆç‡ä¸å¼€å‘ä½“éªŒã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å…¶æ ¸å¿ƒé…ç½®é¡¹ï¼Œæ–¹ä¾¿ä½ å¿«é€ŸæŸ¥é˜…ã€‚</p><table><thead><tr><th style="text-align:left;">é…ç½®ç±»åˆ«</th><th style="text-align:left;">æ ¸å¿ƒé…ç½®é¡¹</th><th style="text-align:center;">å¸¸ç”¨å€¼ç¤ºä¾‹</th><th style="text-align:left;">ä¸»è¦ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>ç¯å¢ƒä¸å…¨å±€è®¾ç½®</strong></td><td style="text-align:left;"><code>environment</code></td><td style="text-align:center;"><code>jsdom</code>, <code>happy-dom</code>, <code>node</code></td><td style="text-align:left;">è®¾ç½®æµ‹è¯•è¿è¡Œç¯å¢ƒï¼Œæ¨¡æ‹Ÿæµè§ˆå™¨æˆ–Node.js</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>globals</code></td><td style="text-align:center;"><code>true</code>, <code>false</code></td><td style="text-align:left;">æ˜¯å¦å…¨å±€æ³¨å…¥<code>describe</code>, <code>it</code>, <code>expect</code>ç­‰APIï¼Œç®€åŒ–å¯¼å…¥</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>setupFiles</code></td><td style="text-align:center;"><code>./tests/setup.ts</code></td><td style="text-align:left;">æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨æµ‹è¯•è¿è¡Œå‰æ‰§è¡Œå…¨å±€åˆå§‹åŒ–ä»£ç </td></tr><tr><td style="text-align:left;"><strong>æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œ</strong></td><td style="text-align:left;"><code>include</code></td><td style="text-align:center;"><code>[&#39;**/*.{test,spec}.{js,ts}&#39;]</code></td><td style="text-align:left;">å®šä¹‰å“ªäº›æ–‡ä»¶è¢«è¯†åˆ«ä¸ºæµ‹è¯•æ–‡ä»¶</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>exclude</code></td><td style="text-align:center;"><code>[&#39;node_modules&#39;]</code></td><td style="text-align:left;">æ’é™¤ä¸éœ€è¦æµ‹è¯•çš„æ–‡ä»¶æˆ–ç›®å½•</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>watch</code></td><td style="text-align:center;"><code>true</code>, <code>false</code></td><td style="text-align:left;">æ˜¯å¦å¯ç”¨ç›‘å¬æ¨¡å¼ï¼Œæ–‡ä»¶å˜æ›´æ—¶è‡ªåŠ¨é‡æ–°è¿è¡Œç›¸å…³æµ‹è¯•</td></tr><tr><td style="text-align:left;"><strong>è¦†ç›–ç‡æŠ¥å‘Š</strong></td><td style="text-align:left;"><code>coverage</code></td><td style="text-align:center;"><code>{ reporter: [&#39;html&#39;, &#39;text&#39;] }</code></td><td style="text-align:left;">é…ç½®è¦†ç›–ç‡å·¥å…·ï¼Œç”Ÿæˆå¤šç§æ ¼å¼çš„æŠ¥å‘Š</td></tr><tr><td style="text-align:left;"><strong>æ¨¡æ‹Ÿä¸åˆ«å</strong></td><td style="text-align:left;"><code>alias</code></td><td style="text-align:center;"><code>{ &#39;@&#39;: &#39;/src&#39; }</code></td><td style="text-align:left;">è®¾ç½®è·¯å¾„åˆ«åï¼Œä¸Viteé¡¹ç›®é…ç½®ä¿æŒä¸€è‡´</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>restoreMocks</code></td><td style="text-align:center;"><code>true</code>, <code>false</code></td><td style="text-align:left;">æ˜¯å¦åœ¨æ¯ä¸ªæµ‹è¯•åè‡ªåŠ¨é‡ç½®æ‰€æœ‰æ¨¡æ‹Ÿï¼ˆmockï¼‰</td></tr></tbody></table><h3 id="ğŸ’»-ç¯å¢ƒä¸å…¨å±€è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ’»-ç¯å¢ƒä¸å…¨å±€è®¾ç½®"><span>ğŸ’» ç¯å¢ƒä¸å…¨å±€è®¾ç½®</span></a></h3><p>è¿™æ˜¯é…ç½®çš„åŸºçŸ³ï¼Œå†³å®šäº†æµ‹è¯•ä»£ç çš„è¿è¡Œä¸Šä¸‹æ–‡ã€‚</p><ul><li><p><strong><code>environment</code>ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰</strong>ï¼šè¿™æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªé…ç½®ã€‚</p><ul><li><p><strong><code>jsdom</code>/ <code>happy-dom</code></strong>ï¼šå½“æµ‹è¯•<strong>Vueã€Reactç­‰ç»„ä»¶</strong>æ—¶ï¼Œéœ€è¦æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼ˆå¦‚<code>window</code>, <code>document</code>å¯¹è±¡ï¼‰ã€‚<code>jsdom</code>æ˜¯åŠŸèƒ½å…¨é¢çš„æ ‡å‡†é€‰æ‹©ï¼Œè€Œ<code>happy-dom</code>åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½æ›´å¿« ã€‚</p></li><li><p><strong><code>node</code></strong>ï¼šå¦‚æœæµ‹è¯•çš„æ˜¯<strong>çº¯Node.jsåç«¯é€»è¾‘æˆ–å·¥å…·å‡½æ•°</strong>ï¼Œåˆ™åº”é€‰æ‹©æ­¤ç¯å¢ƒ ã€‚</p></li></ul><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// vite.config.ts / vitest.config.ts</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  test<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    environment<span class="token operator">:</span> <span class="token string">&#39;jsdom&#39;</span><span class="token punctuation">,</span> <span class="token comment">// ä¸ºç»„ä»¶æµ‹è¯•å¯ç”¨æµè§ˆå™¨ç¯å¢ƒæ¨¡æ‹Ÿ</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>globals</code>ï¼ˆå…¨å±€APIï¼‰</strong>ï¼šè®¾ç½®ä¸º<code>true</code>åï¼Œä½ å¯ä»¥åœ¨æµ‹è¯•æ–‡ä»¶ä¸­ç›´æ¥ä½¿ç”¨<code>describe</code>, <code>it</code>, <code>expect</code>ç­‰å‡½æ•°ï¼Œè€Œæ— éœ€åœ¨æ¯ä¸ªæ–‡ä»¶é‡Œå•ç‹¬å¯¼å…¥ï¼Œè®©ä»£ç æ›´ç®€æ´ ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// å½“ globals: true æ—¶ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</span></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;my test suite&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should work&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// å¦åˆ™ï¼Œéœ€è¦ä» &#39;vitest&#39; æ˜¾å¼å¯¼å…¥ï¼š</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>setupFiles</code>ï¼ˆè®¾ç½®æ–‡ä»¶ï¼‰</strong>ï¼šç”¨äºæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªåœ¨æ¯ä¸ªæµ‹è¯•è¿è¡Œ<strong>ä¹‹å‰</strong>ä¼šæ‰§è¡Œçš„è„šæœ¬ã€‚é€šå¸¸åœ¨è¿™é‡Œè¿›è¡Œå…¨å±€çš„æµ‹è¯•ç¯å¢ƒè®¾ç½®ï¼Œä¾‹å¦‚é…ç½®æµ‹è¯•åº“ã€æ¨¡æ‹Ÿå…¨å±€å˜é‡æˆ–åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// vitest.config.ts</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  test<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    setupFiles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;./tests/setup.ts&#39;</span><span class="token punctuation">]</span> <span class="token comment">// æŒ‡å‘ä½ çš„è®¾ç½®æ–‡ä»¶</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// tests/setup.ts ç¤ºä¾‹ï¼šæ‰©å±•æ–­è¨€ã€è®¾ç½®å…¨å±€æ¨¡æ‹Ÿ</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&#39;@testing-library/jest-dom/vitest&#39;</span> <span class="token comment">// æ‰©å±•äº†å¦‚.toBeInTheDocument()ç­‰DOMæ–­è¨€</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ¨¡æ‹Ÿå…¨å±€å‡½æ•°ï¼Œå¦‚æµè§ˆå™¨API</span></span>
<span class="line">window<span class="token punctuation">.</span>matchMedia <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span>query <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  matches<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  media<span class="token operator">:</span> query<span class="token punctuation">,</span></span>
<span class="line">  onchange<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">  addEventListener<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  removeEventListener<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  dispatchEvent<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="ğŸ”-æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œæ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#ğŸ”-æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œæ§åˆ¶"><span>ğŸ” æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œæ§åˆ¶</span></a></h3><p>è¿™äº›é…ç½®æ§åˆ¶ç€å“ªäº›æµ‹è¯•ä¼šè¢«æ‰§è¡Œä»¥åŠå¦‚ä½•æ‰§è¡Œã€‚</p><ul><li><p><strong><code>include</code>/ <code>exclude</code></strong>ï¼šä½¿ç”¨å…¨å±€æ¨¡å¼æ¥å‘Šè¯‰Vitestå“ªäº›æ–‡ä»¶æ˜¯æµ‹è¯•æ–‡ä»¶ã€‚é€šå¸¸è®¾ç½®ä¸ºåŒ¹é…å¦‚<code>**/*.{test,spec}.{js,ts,jsx,tsx}</code>çš„æ¨¡å¼ï¼Œå¹¶æ’é™¤<code>node_modules</code>ç­‰ç›®å½• ã€‚</p></li><li><p><strong><code>watch</code>ï¼ˆç›‘å¬æ¨¡å¼ï¼‰</strong>ï¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°†æ­¤é€‰é¡¹è®¾ç½®ä¸º<code>true</code>ï¼ˆæˆ–ç›´æ¥ä½¿ç”¨<code>vitest</code>å‘½ä»¤ï¼Œå› ä¸ºwatchæ¨¡å¼é»˜è®¤å¼€å¯ï¼‰éå¸¸æœ‰ç”¨ã€‚å½“ä½ ä¿®æ”¹æºä»£ç æˆ–æµ‹è¯•æ–‡ä»¶æ—¶ï¼ŒVitestä¼šè‡ªåŠ¨é‡æ–°è¿è¡Œç›¸å…³çš„æµ‹è¯•ï¼Œæä¾›å³æ—¶åé¦ˆ ã€‚</p></li></ul><h3 id="ğŸ“Š-è¦†ç›–ç‡æŠ¥å‘Š" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-è¦†ç›–ç‡æŠ¥å‘Š"><span>ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Š</span></a></h3><p>è¦†ç›–ç‡å·¥å…·å¸®åŠ©ä½ äº†è§£æµ‹è¯•æ˜¯å¦å…¨é¢è¦†ç›–äº†ä¸šåŠ¡ä»£ç ã€‚</p><ul><li><p><strong><code>coverage</code>ï¼ˆè¦†ç›–ç‡é…ç½®ï¼‰</strong>ï¼šéœ€è¦å…ˆå®‰è£…è¦†ç›–ç‡ä¾èµ–ï¼ˆå¦‚<code>@vitest/coverage-v8</code>ï¼‰ã€‚å¯ç”¨åï¼ŒVitestä¼šåˆ†ææµ‹è¯•æ‰§è¡Œè¿‡ç¨‹ä¸­å“ªäº›ä»£ç è¡Œã€å‡½æ•°ã€åˆ†æ”¯å’Œè¯­å¥è¢«è¦†ç›–åˆ°äº†</p><p>ã€‚</p><div class="language-npm line-numbers-mode" data-highlighter="prismjs" data-ext="npm"><pre><code><span class="line"># å®‰è£…è¦†ç›–ç‡å·¥å…·</span>
<span class="line">npm install -D @vitest/coverage-v8</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// vitest.config.ts</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  test<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    coverage<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      provider<span class="token operator">:</span> <span class="token string">&#39;v8&#39;</span><span class="token punctuation">,</span> <span class="token comment">// æˆ– &#39;istanbul&#39;</span></span>
<span class="line">      reporter<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;text&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;html&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;json&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// åœ¨æ§åˆ¶å°ã€HTMLæ–‡ä»¶ç­‰å¤šç§æ ¼å¼è¾“å‡ºæŠ¥å‘Š</span></span>
<span class="line">      reportsDirectory<span class="token operator">:</span> <span class="token string">&#39;./coverage&#39;</span><span class="token punctuation">,</span> <span class="token comment">// æŠ¥å‘Šè¾“å‡ºç›®å½•</span></span>
<span class="line">      exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;tests/**&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// æ’é™¤æµ‹è¯•æ–‡ä»¶æœ¬èº«</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œ<code>vitest run --coverage</code>å³å¯ç”ŸæˆæŠ¥å‘Šã€‚HTMLæŠ¥å‘Šé€šå¸¸æœ€ç›´è§‚ï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°æ¯ä¸ªæ–‡ä»¶çš„è¦†ç›–æƒ…å†µã€‚</p></li></ul><h3 id="ğŸ› ï¸-é«˜çº§ä¸æ¡†æ¶é›†æˆé…ç½®" tabindex="-1"><a class="header-anchor" href="#ğŸ› ï¸-é«˜çº§ä¸æ¡†æ¶é›†æˆé…ç½®"><span>ğŸ› ï¸ é«˜çº§ä¸æ¡†æ¶é›†æˆé…ç½®</span></a></h3><ul><li><p><strong>è·¯å¾„åˆ«åï¼ˆ<code>alias</code>ï¼‰</strong>ï¼šä¸ºäº†è®©æµ‹è¯•ä¸­çš„æ¨¡å—å¯¼å…¥è·¯å¾„ä¸ä½ çš„Viteé¡¹ç›®é…ç½®ä¿æŒä¸€è‡´ï¼Œéœ€è¦é…ç½®ç›¸åŒçš„åˆ«åã€‚è¿™é€šå¸¸åœ¨Viteçš„<code>resolve.alias</code>ä¸­é…ç½®ï¼ŒVitestä¼šç»§æ‰¿æˆ–éœ€è¦ä½ å•ç‹¬æŒ‡å®š ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// vite.config.ts</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span></span>
<span class="line"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&#39;node:path&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  resolve<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    alias<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&#39;@&#39;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  test<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ... å…¶ä»–æµ‹è¯•é…ç½®</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å¤„ç†CSSç­‰é™æ€èµ„æº</strong>ï¼šåœ¨æµ‹è¯•ä¸­å¼•å…¥CSSæˆ–Vueå•æ–‡ä»¶ç»„ä»¶æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°<code>Unknown file extension</code>é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºVitestéœ€è¦çŸ¥é“å¦‚ä½•å¤„ç†è¿™äº›éJS/TSèµ„æºã€‚è§£å†³æ–¹æ¡ˆæ˜¯ç¡®ä¿å·²å®‰è£…å¹¶é…ç½®äº†å¯¹åº”çš„Viteæ’ä»¶ï¼ˆå¦‚<code>@vitejs/plugin-vue</code>ï¼‰ï¼Œå¹¶ä¸”æµ‹è¯•é…ç½®æ­£ç¡®å…³è”äº†Viteçš„ä¸»é…ç½® ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// vitest.config.ts åº”æ­£ç¡®ç»§æ‰¿æˆ–åˆå¹¶ vite.config.ts çš„é…ç½®</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest/config&#39;</span></span>
<span class="line"><span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ç¡®ä¿å¤„ç†.vueæ–‡ä»¶çš„æ’ä»¶å·²é…ç½®</span></span>
<span class="line">  test<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ... å…¶ä»–æµ‹è¯•é…ç½®</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="testapi" tabindex="-1"><a class="header-anchor" href="#testapi"><span>TestApi</span></a></h2><p>Vitest æä¾›äº†ä¸€å¥—ä¸°å¯Œè€Œç›´è§‚çš„æµ‹è¯• APIï¼Œç†è§£å…¶æ ¸å¿ƒæ¥å£çš„åŒºåˆ«ä¸é€‚ç”¨åœºæ™¯ï¼Œèƒ½å¸®åŠ©ä½ æ›´é«˜æ•ˆåœ°ç¼–å†™æµ‹è¯•ã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ¢³ç†äº†å…¶ä¸»è¦çš„æµ‹è¯• API åŠå…¶æ ¸å¿ƒä½œç”¨ã€‚</p><h3 id="ğŸ”‘åŒºåˆ«è”ç³»" tabindex="-1"><a class="header-anchor" href="#ğŸ”‘åŒºåˆ«è”ç³»"><span>ğŸ”‘åŒºåˆ«è”ç³»</span></a></h3><table><thead><tr><th style="text-align:center;">API åˆ†ç±»</th><th style="text-align:center;">å…³é”® API</th><th style="text-align:center;">ä¸»è¦åŒºåˆ«ä¸ä½œç”¨</th><th style="text-align:center;">é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td style="text-align:center;"><strong>ç”¨ä¾‹å®šä¹‰</strong></td><td style="text-align:center;"><code>test</code>/ <code>it</code></td><td style="text-align:center;">åŠŸèƒ½<strong>å®Œå…¨ç›¸åŒ</strong>ï¼Œå‡ç”¨äºå®šä¹‰å•ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚<code>test</code>æºè‡ª Jest é£æ ¼ï¼Œ<code>it</code>æºè‡ª BDDï¼ˆè¡Œä¸ºé©±åŠ¨å¼€å‘ï¼‰é£æ ¼ï¼Œé€‰æ‹©å…¶ä¸€å¹¶åœ¨å›¢é˜Ÿå†…ç»Ÿä¸€å³å¯ã€‚</td><td style="text-align:center;">å®šä¹‰æ¯ä¸€ä¸ªå…·ä½“çš„æµ‹è¯•æ¡ˆä¾‹ã€‚</td></tr><tr><td style="text-align:center;"><strong>æµ‹è¯•å¥—ä»¶</strong></td><td style="text-align:center;"><code>describe</code></td><td style="text-align:center;">ç”¨äº<strong>ç»„ç»‡</strong>å¤šä¸ªç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹ï¼ˆ<code>test</code>/<code>it</code>ï¼‰æˆä¸€ä¸ªç»„ï¼Œæ”¯æŒåµŒå¥—ï¼Œæä¾›æ¸…æ™°çš„æµ‹è¯•ç»“æ„ã€‚</td><td style="text-align:center;">å°†åŒä¸€åŠŸèƒ½æ¨¡å—æˆ–ç»„ä»¶çš„æµ‹è¯•ç”¨ä¾‹åˆ†ç»„ç®¡ç†ã€‚</td></tr><tr><td style="text-align:center;"><strong>ç”¨ä¾‹ä¿®é¥°ç¬¦</strong></td><td style="text-align:center;"><code>.skip</code></td><td style="text-align:center;"><strong>è·³è¿‡</strong>è¢«ä¿®é¥°çš„æµ‹è¯•ç”¨ä¾‹æˆ–å¥—ä»¶ï¼Œä½¿å…¶ä¸è¿è¡Œã€‚</td><td style="text-align:center;">ä¸´æ—¶è·³è¿‡å°šæœªå®Œæˆæˆ–å­˜åœ¨é—®é¢˜çš„æµ‹è¯•ã€‚</td></tr><tr><td style="text-align:center;">ã€ã€ã€</td><td style="text-align:center;"><code>.only</code></td><td style="text-align:center;"><strong>ä»…è¿è¡Œ</strong>è¢«ä¿®é¥°çš„æµ‹è¯•ç”¨ä¾‹æˆ–å¥—ä»¶ï¼Œæ–¹ä¾¿å¿«é€Ÿè°ƒè¯•ç‰¹å®šé—®é¢˜ã€‚</td><td style="text-align:center;">èšç„¦äºå•ä¸ªå¤±è´¥æˆ–æ­£åœ¨ç¼–å†™çš„æµ‹è¯•ã€‚</td></tr><tr><td style="text-align:center;"></td><td style="text-align:center;"><code>.todo</code></td><td style="text-align:center;"><strong>æ ‡è®°</strong>ä¸€ä¸ªè®¡åˆ’ç¼–å†™ä½†å°šæœªå®ç°çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨æµ‹è¯•æŠ¥å‘Šä¸­ä¼šæ˜¾ç¤ºä¸ºå¾…åŠäº‹é¡¹ã€‚</td><td style="text-align:center;">è§„åˆ’æµ‹è¯•ç”¨ä¾‹ï¼Œé˜²æ­¢é—æ¼ã€‚</td></tr><tr><td style="text-align:center;"></td><td style="text-align:center;"><code>.concurrent</code></td><td style="text-align:center;">è¢«ä¿®é¥°çš„æµ‹è¯•ç”¨ä¾‹ä¼š<strong>å¹¶å‘</strong>æ‰§è¡Œï¼Œå¯ä»¥æ˜¾è‘—æå‡æµ‹è¯•é€Ÿåº¦ã€‚</td><td style="text-align:center;">é€‚ç”¨äºå¤§é‡ç›¸äº’ç‹¬ç«‹çš„ I/O æ“ä½œæˆ–å¼‚æ­¥æµ‹è¯•ã€‚</td></tr><tr><td style="text-align:center;"></td><td style="text-align:center;"><code>.sequential</code></td><td style="text-align:center;">åœ¨å·²ä½¿ç”¨ <code>.concurrent</code>çš„å¥—ä»¶å†…ï¼Œç¡®ä¿æŸä¸ªæµ‹è¯•ç”¨ä¾‹<strong>é¡ºåº</strong>æ‰§è¡Œã€‚</td><td style="text-align:center;">éœ€è¦æ§åˆ¶æ‰§è¡Œé¡ºåºçš„ç‰¹å®šæµ‹è¯•ã€‚</td></tr><tr><td style="text-align:center;"></td><td style="text-align:center;"><code>.fails</code></td><td style="text-align:center;">æ˜ç¡®è¡¨ç¤ºè¯¥æµ‹è¯•ç”¨ä¾‹<strong>é¢„æœŸä¼šå¤±è´¥</strong>ï¼ˆä¾‹å¦‚ï¼ŒéªŒè¯ä»£ç åœ¨é”™è¯¯è¾“å…¥ä¸‹ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰ã€‚</td><td style="text-align:center;">æµ‹è¯•é”™è¯¯å¤„ç†é€»è¾‘ã€‚</td></tr><tr><td style="text-align:center;"><strong>æ–­è¨€ä¸éªŒè¯</strong></td><td style="text-align:center;"><code>expect</code></td><td style="text-align:center;">æ–­è¨€åº“çš„å…¥å£å‡½æ•°ï¼Œæä¾›å¤§é‡<strong>åŒ¹é…å™¨</strong>ï¼ˆMatchersï¼‰æ¥éªŒè¯ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</td><td style="text-align:center;">éªŒè¯ä»£ç çš„è¾“å‡ºã€è¡Œä¸ºã€ç±»å‹ç­‰ã€‚</td></tr><tr><td style="text-align:center;"><strong>ç”Ÿå‘½å‘¨æœŸé’©å­</strong></td><td style="text-align:center;"><code>beforeAll</code>/ <code>afterAll\`\`beforeEach</code>/ <code>afterEach</code></td><td style="text-align:center;">ç”¨äºåœ¨æµ‹è¯•<strong>ç”Ÿå‘½å‘¨æœŸ</strong>çš„ç‰¹å®šé˜¶æ®µæ‰§è¡Œè®¾ç½®å’Œæ¸…ç†ä»£ç ã€‚</td><td style="text-align:center;">æµ‹è¯•å‰çš„åˆå§‹åŒ–ï¼ˆå¦‚è¿æ¥æ•°æ®åº“ï¼‰å’Œæµ‹è¯•åçš„æ¸…ç†ï¼ˆå¦‚é‡ç½®çŠ¶æ€ï¼‰ã€‚</td></tr></tbody></table><h3 id="ğŸ’¡-æ ¸å¿ƒ-api-è¯¦è§£ä¸ä½¿ç”¨æŠ€å·§" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-æ ¸å¿ƒ-api-è¯¦è§£ä¸ä½¿ç”¨æŠ€å·§"><span>ğŸ’¡ æ ¸å¿ƒ API è¯¦è§£ä¸ä½¿ç”¨æŠ€å·§</span></a></h3><h4 id="_1-ç»„ç»‡æµ‹è¯•çš„ç»“æ„-describeå’Œ-it-test" tabindex="-1"><a class="header-anchor" href="#_1-ç»„ç»‡æµ‹è¯•çš„ç»“æ„-describeå’Œ-it-test"><span>1. ç»„ç»‡æµ‹è¯•çš„ç»“æ„ï¼š<code>describe</code>å’Œ <code>it</code>/<code>test</code></span></a></h4><p><code>describe</code>å—å¯ä»¥å¸®åŠ©ä½ æ„å»ºæ¸…æ™°çš„æµ‹è¯•å±‚æ¬¡ã€‚ä½ å¯ä»¥åœ¨å…¶å†…éƒ¨ä½¿ç”¨é’©å­å‡½æ•°ï¼Œè¿™äº›é’©å­çš„æ‰§è¡Œé¡ºåºæ˜¯ï¼šå¤–å±‚ <code>beforeEach</code>-&gt; å†…å±‚ <code>beforeEach</code>-&gt; æµ‹è¯•ç”¨ä¾‹ -&gt; å†…å±‚ <code>afterEach</code>-&gt; å¤–å±‚ <code>afterEach</code>ã€‚</p><p>è¿™æœ‰åŠ©äºåœ¨ä¸åŒå±‚çº§è¿›è¡Œå…¬å…±çš„è®¾ç½®å’Œæ¸…ç†ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> beforeEach<span class="token punctuation">,</span> afterEach <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;ç”¨æˆ·ç®¡ç†æ¨¡å—&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å‰çš„å…¬å…±è®¾ç½®ï¼Œä¾‹å¦‚åˆå§‹åŒ–ç”¨æˆ·æ•°æ®</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åçš„æ¸…ç†å·¥ä½œ</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;åˆ›å»ºç”¨æˆ·&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;åº”è¯¥èƒ½æˆåŠŸåˆ›å»ºæ–°ç”¨æˆ·&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// ... æµ‹è¯•é€»è¾‘</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;åº”è¯¥æ‹’ç»åˆ›å»ºé‡å¤ç”¨æˆ·&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// ... æµ‹è¯•é€»è¾‘</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-ç²¾å‡†æ§åˆ¶æµ‹è¯•æ‰§è¡Œ-ä¿®é¥°ç¬¦" tabindex="-1"><a class="header-anchor" href="#_2-ç²¾å‡†æ§åˆ¶æµ‹è¯•æ‰§è¡Œ-ä¿®é¥°ç¬¦"><span>2. ç²¾å‡†æ§åˆ¶æµ‹è¯•æ‰§è¡Œï¼šä¿®é¥°ç¬¦</span></a></h4><p>ä¿®é¥°ç¬¦æ˜¯éå¸¸å®ç”¨çš„è°ƒè¯•å’Œç®¡ç†å·¥å…·ã€‚</p><ul><li><strong>å¿«é€Ÿå®šä½é—®é¢˜</strong>ï¼šå½“æŸä¸ªæµ‹è¯•å¤±è´¥æ—¶ï¼Œå¯ä»¥ä¸´æ—¶ä½¿ç”¨ <code>it.only</code>åªè¿è¡Œè¿™ä¸ªæµ‹è¯•ï¼Œå¿«é€Ÿå®šä½å’Œè°ƒè¯•é—®é¢˜ã€‚</li><li><strong>è§„åˆ’ä¸å¤‡å¿˜</strong>ï¼šä½¿ç”¨ <code>test.todo</code>å¯ä»¥è®°å½•ä½ è®¡åˆ’è¦å†™çš„æµ‹è¯•ï¼Œå®ƒä»¬ä¼šåœ¨æµ‹è¯•æŠ¥å‘Šä¸­æ˜¾ç¤ºå‡ºæ¥ï¼Œæœ‰åŠ©äºç®¡ç†å¼€å‘è¿›åº¦ã€‚</li></ul><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// ä½¿ç”¨ only è¿›è¡Œè°ƒè¯•</span></span>
<span class="line">it<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token string">&#39;è¿™ä¸ªé‡è¦çš„æµ‹è¯•ç°åœ¨å¤±è´¥äº†ï¼Œæˆ‘å…ˆä¸“æ³¨è§£å†³å®ƒ&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ...</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ä½¿ç”¨ todo è¿›è¡Œè§„åˆ’</span></span>
<span class="line">test<span class="token punctuation">.</span><span class="token function">todo</span><span class="token punctuation">(</span><span class="token string">&#39;æœªæ¥éœ€è¦å®ç°: ç”¨æˆ·å¤´åƒä¸Šä¼ çš„æˆåŠŸå’Œå¤±è´¥æƒ…å†µ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-éªŒè¯è¡Œä¸ºçš„å¤šæ ·æ€§-expectæ–­è¨€" tabindex="-1"><a class="header-anchor" href="#_3-éªŒè¯è¡Œä¸ºçš„å¤šæ ·æ€§-expectæ–­è¨€"><span>3. éªŒè¯è¡Œä¸ºçš„å¤šæ ·æ€§ï¼š<code>expect</code>æ–­è¨€</span></a></h4><p><code>expect</code>æ˜¯æµ‹è¯•éªŒè¯çš„æ ¸å¿ƒï¼Œå®ƒæä¾›äº†å¤šç§åŒ¹é…å™¨æ¥åº”å¯¹ä¸åŒæƒ…å†µï¼š</p><ul><li><strong>ä¸¥æ ¼ç›¸ç­‰</strong>ï¼š<code>expect(1 + 1).toBe(2)</code></li><li><strong>å¯¹è±¡å†…å®¹åŒ¹é…</strong>ï¼š<code>expect({ name: &#39;Vitest&#39; }).toEqual({ name: &#39;Vitest&#39; })</code></li><li><strong>é”™è¯¯æŠ›å‡º</strong>ï¼š<code>expect(() =&gt; { someFunction(); }).toThrow()</code></li><li><strong>å¼‚æ­¥ä»£ç æµ‹è¯•</strong>ï¼š<code>await expect(Promise.resolve(&#39;data&#39;)).resolves.toBe(&#39;data&#39;)</code></li></ul><h4 id="_4-ç®¡ç†æµ‹è¯•ç¯å¢ƒ-ç”Ÿå‘½å‘¨æœŸé’©å­" tabindex="-1"><a class="header-anchor" href="#_4-ç®¡ç†æµ‹è¯•ç¯å¢ƒ-ç”Ÿå‘½å‘¨æœŸé’©å­"><span>4. ç®¡ç†æµ‹è¯•ç¯å¢ƒï¼šç”Ÿå‘½å‘¨æœŸé’©å­</span></a></h4><p>ç”Ÿå‘½å‘¨æœŸé’©å­å¯¹äºä¿æŒæµ‹è¯•çš„ç‹¬ç«‹æ€§å’Œå¯é‡å¤æ€§è‡³å…³é‡è¦ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åœ¨ <code>beforeEach</code>ä¸­è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œè¿™ç›¸å½“äºåœ¨è¯¥æµ‹è¯•ç”¨ä¾‹çš„ <code>afterEach</code>é˜¶æ®µæ‰§è¡Œï¼Œæœ‰åŠ©äºç®¡ç†ç´§å¯†å…³è”çš„ä¸Šä¸‹æ–‡ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> beforeEach <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;æ•°æ®åº“æ“ä½œ&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> connection <span class="token operator">=</span> <span class="token function">establishDBConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">// è¿”å›ä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œå®ƒä¼šåœ¨å½“å‰æµ‹è¯•ç»“æŸåæ‰§è¡Œ</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;æµ‹è¯•æŸ¥è¯¢&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ... ä½¿ç”¨è¿æ¥è¿›è¡Œæµ‹è¯•</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æµ‹è¯•ç»“æŸåï¼Œè¿æ¥ä¼šè‡ªåŠ¨å…³é—­</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ğŸ’-å®è·µå»ºè®®" tabindex="-1"><a class="header-anchor" href="#ğŸ’-å®è·µå»ºè®®"><span>ğŸ’ å®è·µå»ºè®®</span></a></h3><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œç»“åˆ **<code>describe</code><strong>è¿›è¡Œåˆ†ç»„ï¼Œå–„ç”¨ <strong><code>.skip</code></strong>ã€</strong><code>.only</code>**å’Œ **<code>.todo</code>**æ¥ç®¡ç†æµ‹è¯•æ‰§è¡Œä¸è§„åˆ’ï¼Œå¹¶åˆ©ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ä¿æŒæµ‹è¯•çš„æ•´æ´ï¼Œè¿™å°†æå¤§æå‡ä½ çš„æµ‹è¯•æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚</p><p>å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œè¿ç”¨ Vitest çš„æµ‹è¯• APIï¼å¦‚æœä½ å¯¹æŸä¸ªç‰¹å®šçš„ API æˆ–åœºæ™¯æœ‰æ›´æ·±å…¥çš„ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨ã€‚</p><h2 id="mockapi" tabindex="-1"><a class="header-anchor" href="#mockapi"><span>MockApi</span></a></h2><p>Vitest æä¾›äº†ä¸€å¥—å¼ºå¤§è€Œçµæ´»çš„ Mock APIï¼Œç”¨äºåœ¨æµ‹è¯•ä¸­æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–ã€æ§åˆ¶æ—¶é—´ã€æ‹¦æˆªå‡½æ•°è°ƒç”¨ç­‰ã€‚</p><h3 id="ğŸ“Š-vitest-mock-api-æ¦‚è§ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-vitest-mock-api-æ¦‚è§ˆ"><span>ğŸ“Š Vitest Mock API æ¦‚è§ˆ</span></a></h3><table><thead><tr><th>API åˆ†ç±»</th><th>æ ¸å¿ƒ API</th><th>ä¸»è¦ä½œç”¨</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>å‡½æ•°æ¨¡æ‹Ÿ</strong></td><td><code>vi.fn()</code></td><td>åˆ›å»º<strong>å¯è·Ÿè¸ª</strong>çš„æ¨¡æ‹Ÿå‡½æ•°ï¼Œè®°å½•è°ƒç”¨ä¿¡æ¯</td><td>æ¨¡æ‹Ÿå›è°ƒå‡½æ•°ã€äº‹ä»¶å¤„ç†å™¨</td></tr><tr><td><strong>æ¨¡å—æ¨¡æ‹Ÿ</strong></td><td><code>vi.mock()</code></td><td>æ¨¡æ‹Ÿæ•´ä¸ªæ¨¡å—çš„å¯¼å…¥è¡Œä¸º</td><td>æ›¿æ¢ç¬¬ä¸‰æ–¹åº“ã€å¤–éƒ¨ä¾èµ–</td></tr><tr><td><strong>å¯¹è±¡ç›‘è§†</strong></td><td><code>vi.spyOn()</code></td><td>ç›‘è§†å¯¹è±¡æ–¹æ³•è°ƒç”¨ï¼Œå¯é€‰æ‹©æ˜¯å¦æ¨¡æ‹Ÿå®ç°</td><td>éªŒè¯ç‰¹å®šæ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨</td></tr><tr><td><strong>å®šæ—¶å™¨æ§åˆ¶</strong></td><td><code>vi.useFakeTimers()</code></td><td>æ¨¡æ‹Ÿæ—¶é—´ç›¸å…³å‡½æ•°</td><td>æµ‹è¯• setTimeoutã€setInterval ç­‰</td></tr><tr><td><strong>æ—¥æœŸæ—¶é—´</strong></td><td><code>vi.setSystemTime()</code></td><td>å›ºå®šç³»ç»Ÿæ—¶é—´</td><td>æµ‹è¯•æ—¶é—´ç›¸å…³é€»è¾‘</td></tr><tr><td><strong>å…¨å±€å˜é‡</strong></td><td><code>vi.stubGlobal()</code></td><td>æ¨¡æ‹Ÿå…¨å±€å˜é‡</td><td>æµ‹è¯• windowã€document ç­‰</td></tr></tbody></table><h3 id="ğŸ”§-æ ¸å¿ƒ-mock-api-è¯¦è§£" tabindex="-1"><a class="header-anchor" href="#ğŸ”§-æ ¸å¿ƒ-mock-api-è¯¦è§£"><span>ğŸ”§ æ ¸å¿ƒ Mock API è¯¦è§£</span></a></h3><h4 id="_1-vi-fn-å‡½æ•°æ¨¡æ‹Ÿ" tabindex="-1"><a class="header-anchor" href="#_1-vi-fn-å‡½æ•°æ¨¡æ‹Ÿ"><span>1. <code>vi.fn()</code>- å‡½æ•°æ¨¡æ‹Ÿ</span></a></h4><p>åˆ›å»ºå¯è·Ÿè¸ªçš„æ¨¡æ‹Ÿå‡½æ•°ï¼Œç”¨äºéªŒè¯å‡½æ•°æ˜¯å¦è¢«è°ƒç”¨ã€è°ƒç”¨å‚æ•°ç­‰ä¿¡æ¯ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> vi<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åŸºç¡€ç”¨æ³•</span></span>
<span class="line"><span class="token keyword">const</span> mockCallback <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">mockCallback</span><span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// éªŒè¯è°ƒç”¨æƒ…å†µ</span></span>
<span class="line"><span class="token function">expect</span><span class="token punctuation">(</span>mockCallback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">expect</span><span class="token punctuation">(</span>mockCallback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">&#39;hello&#39;</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">expect</span><span class="token punctuation">(</span>mockCallback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// è®¾ç½®è¿”å›å€¼</span></span>
<span class="line"><span class="token keyword">const</span> mockFn <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">mockReturnValue</span><span class="token punctuation">(</span><span class="token string">&#39;default value&#39;</span><span class="token punctuation">)</span>           <span class="token comment">// å›ºå®šè¿”å›å€¼</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token string">&#39;async value&#39;</span><span class="token punctuation">)</span>          <span class="token comment">// å¼‚æ­¥è¿”å›å€¼</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span>       <span class="token comment">// è‡ªå®šä¹‰å®ç°</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// é“¾å¼è°ƒç”¨ç¤ºä¾‹</span></span>
<span class="line"><span class="token keyword">const</span> mockService <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">mockReturnValueOnce</span><span class="token punctuation">(</span><span class="token string">&#39;first call&#39;</span><span class="token punctuation">)</span>          <span class="token comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨è¿”å›</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">mockReturnValueOnce</span><span class="token punctuation">(</span><span class="token string">&#39;second call&#39;</span><span class="token punctuation">)</span>         <span class="token comment">// ç¬¬äºŒæ¬¡è°ƒç”¨è¿”å›</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">mockReturnValue</span><span class="token punctuation">(</span><span class="token string">&#39;default value&#39;</span><span class="token punctuation">)</span>          <span class="token comment">// åç»­è°ƒç”¨è¿”å›</span></span>
<span class="line"></span>
<span class="line"><span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">mockService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;first call&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">mockService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;second call&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">mockService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;default value&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-vi-mock-æ¨¡å—æ¨¡æ‹Ÿ" tabindex="-1"><a class="header-anchor" href="#_2-vi-mock-æ¨¡å—æ¨¡æ‹Ÿ"><span>2. <code>vi.mock()</code>- æ¨¡å—æ¨¡æ‹Ÿ</span></a></h4><p>æ¨¡æ‹Ÿæ•´ä¸ªæ¨¡å—ï¼Œé€‚ç”¨äºæ›¿æ¢ç¬¬ä¸‰æ–¹åº“æˆ–å¤–éƒ¨ä¾èµ–ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// æ¨¡æ‹Ÿæ•´ä¸ªæ¨¡å—</span></span>
<span class="line">vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#39;axios&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  get<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token string">&#39;mocked data&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  post<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">Promise</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;Network error&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åœ¨æµ‹è¯•æ–‡ä»¶ä¸­ä½¿ç”¨</span></span>
<span class="line"><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&#39;axios&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./userService&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;åº”è¯¥æ¨¡æ‹Ÿaxiosè°ƒç”¨&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">expect</span><span class="token punctuation">(</span>axios<span class="token punctuation">.</span>get<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">&#39;/users/1&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;mocked data&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ä½¿ç”¨ __mocks__ ç›®å½•çš„è‡ªåŠ¨æ¨¡æ‹Ÿ</span></span>
<span class="line"><span class="token comment">// åˆ›å»º __mocks__/api.js</span></span>
<span class="line">vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#39;./api&#39;</span><span class="token punctuation">)</span> <span class="token comment">// ä¼šè‡ªåŠ¨æŸ¥æ‰¾ __mocks__/api.js</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-vi-spyon-å¯¹è±¡æ–¹æ³•ç›‘è§†" tabindex="-1"><a class="header-anchor" href="#_3-vi-spyon-å¯¹è±¡æ–¹æ³•ç›‘è§†"><span>3. <code>vi.spyOn()</code>- å¯¹è±¡æ–¹æ³•ç›‘è§†</span></a></h4><p>ç›‘è§†å¯¹è±¡æ–¹æ³•è°ƒç”¨ï¼Œå¯ä»¥é€‰æ‹©æ˜¯å¦æ›¿æ¢åŸå§‹å®ç°ã€‚</p><p>æ³¨æ„æ­¤å¤„ api.fetchData(&#39;test&#39;)ä¸­æ˜¯ä¸ºäº†åç»­æµ‹è¯•è¯æ˜æ˜¯testè¿™ä¸ªå‚æ•°è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œå› ä¸ºåœ¨JavaScript/TypeScript ä¸­ï¼Œå‘ä¸€ä¸ªä¸æœŸæœ›å‚æ•°çš„å‡½æ•°ä¼ é€’å‚æ•°ï¼Œé€šå¸¸ä¸ä¼šå¯¼è‡´å‡½æ•°æŠ¥é”™ï¼ˆé™¤éå‡½æ•°å†…éƒ¨æ˜¾å¼æ£€æŸ¥å‚æ•°ï¼‰ï¼Œå¤šä½™çš„å‚æ•°ä¼šè¢«å¿½ç•¥ã€‚å› æ­¤ï¼Œç»“æœ <code>result</code>ä¾ç„¶æ˜¯ <code>&#39;real data&#39;</code>ã€‚ä½†æ˜¯è¿™ä¸ªspyå°±èƒ½ç›‘æ§åˆ°æ¿€å‘è¿™ä¸ªå‡½æ•°çš„å‚æ•°æ˜¯test</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> vi<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> api <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function-variable function">fetchData</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;real data&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token function-variable function">saveData</span><span class="token operator">:</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">saved: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;spyOn ç¤ºä¾‹&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;åº”è¯¥ç›‘è§†æ–¹æ³•è°ƒç”¨ä½†ä¸æ”¹å˜å®ç°&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> spy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> <span class="token string">&#39;fetchData&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">const</span> result <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>spy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;real data&#39;</span><span class="token punctuation">)</span> <span class="token comment">// åŸå§‹å®ç°ä»æœ‰æ•ˆ</span></span>
<span class="line">    </span>
<span class="line">    spy<span class="token punctuation">.</span><span class="token function">mockRestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ¸…ç†spy</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;å¯ä»¥æ›¿æ¢æ–¹æ³•å®ç°&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> spy <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> <span class="token string">&#39;fetchData&#39;</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">&#39;mocked data&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">const</span> result <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;mocked data&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    spy<span class="token punctuation">.</span><span class="token function">mockRestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-å®šæ—¶å™¨æ¨¡æ‹Ÿ" tabindex="-1"><a class="header-anchor" href="#_4-å®šæ—¶å™¨æ¨¡æ‹Ÿ"><span>4. å®šæ—¶å™¨æ¨¡æ‹Ÿ</span></a></h4><p>æ§åˆ¶æ—¶é—´ç›¸å…³çš„å‡½æ•°ï¼Œé¿å…æµ‹è¯•ä¸­çš„çœŸå®ç­‰å¾…ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> vi<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> beforeEach<span class="token punctuation">,</span> afterEach <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;å®šæ—¶å™¨æµ‹è¯•&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    vi<span class="token punctuation">.</span><span class="token function">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å¯ç”¨å‡å®šæ—¶å™¨</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    vi<span class="token punctuation">.</span><span class="token function">useRealTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ¢å¤çœŸå®å®šæ—¶å™¨</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;æµ‹è¯• setTimeout&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> callback <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    vi<span class="token punctuation">.</span><span class="token function">advanceTimersByTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">// å¿«è¿›1ç§’</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;æµ‹è¯• setInterval&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> callback <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">setInterval</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    vi<span class="token punctuation">.</span><span class="token function">advanceTimersByTime</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span> <span class="token comment">// å¿«è¿›3ç§’</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;è¿è¡Œæ‰€æœ‰å®šæ—¶å™¨&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> callback1 <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">const</span> callback2 <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span>callback1<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span>callback2<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    vi<span class="token punctuation">.</span><span class="token function">runAllTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¿è¡Œæ‰€æœ‰å®šæ—¶å™¨</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>callback1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>callback2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-æ—¥æœŸæ—¶é—´æ¨¡æ‹Ÿ" tabindex="-1"><a class="header-anchor" href="#_5-æ—¥æœŸæ—¶é—´æ¨¡æ‹Ÿ"><span>5. æ—¥æœŸæ—¶é—´æ¨¡æ‹Ÿ</span></a></h4><p>å›ºå®šç³»ç»Ÿæ—¶é—´ï¼Œç¡®ä¿æ—¶é—´ç›¸å…³æµ‹è¯•çš„ä¸€è‡´æ€§ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> vi<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect<span class="token punctuation">,</span> beforeEach<span class="token punctuation">,</span> afterEach <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;æ—¥æœŸæ—¶é—´æµ‹è¯•&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    vi<span class="token punctuation">.</span><span class="token function">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token comment">// å›ºå®šä¸ºç‰¹å®šæ—¥æœŸ</span></span>
<span class="line">    vi<span class="token punctuation">.</span><span class="token function">setSystemTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">&#39;2024-01-01&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    vi<span class="token punctuation">.</span><span class="token function">useRealTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;åº”è¯¥æ¨¡æ‹Ÿå½“å‰æ—¶é—´&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">getFullYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2024</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// 0 = ä¸€æœˆ</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>now<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;æµ‹è¯•æ—¶é—´ç›¸å…³é€»è¾‘&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token function-variable function">isNewYear</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> today <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token keyword">return</span> today<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> today<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">1</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isNewYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-mockreturnvalue" tabindex="-1"><a class="header-anchor" href="#_6-mockreturnvalue"><span>6. mockReturnValue</span></a></h4><p>æ¥å—ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼å°†åœ¨æ¨¡æ‹Ÿå‡½æ•°æ¯æ¬¡è¢«è°ƒç”¨æ—¶è¿”å›ã€‚TypeScript ä»…æ¥å—ä¸åŸå§‹å‡½æ•°è¿”å›ç±»å‹ä¸€è‡´çš„å€¼ã€‚</p><p>ä½ æä¾›çš„è¿™æ®µä»£ç å±•ç¤ºäº†åœ¨æµ‹è¯•ä¸­å¦‚ä½•ä½¿ç”¨ <code>mockReturnValue</code>æ¥æ§åˆ¶å’ŒéªŒè¯ä¸€ä¸ªæ¨¡å—ï¼ˆè¿™é‡Œæ˜¯ EChartsï¼‰çš„æ–¹æ³•è¡Œä¸ºã€‚ä¸‹é¢æˆ‘ä»¬ä¸€æ­¥æ­¥è§£æã€‚</p><h5 id="ğŸ§ -æ ¸å¿ƒæ¦‚å¿µ-mockreturnvalueæ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ§ -æ ¸å¿ƒæ¦‚å¿µ-mockreturnvalueæ˜¯ä»€ä¹ˆ"><span>ğŸ§  æ ¸å¿ƒæ¦‚å¿µï¼š<code>mockReturnValue</code>æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></h5><p><code>mockReturnValue</code>æ˜¯ Jest å’Œ Vitest ç­‰æµ‹è¯•æ¡†æ¶ä¸­æ¨¡æ‹Ÿå‡½æ•°ï¼ˆMock Functionï¼‰çš„ä¸€ä¸ªæ–¹æ³•ã€‚å®ƒçš„ä½œç”¨æ˜¯<strong>ä¸ºæ¨¡æ‹Ÿå‡½æ•°æŒ‡å®šä¸€ä¸ªå›ºå®šçš„è¿”å›å€¼</strong>ã€‚</p><p>å½“ä½ åœ¨æµ‹è¯•ä¸­è°ƒç”¨ä¸€ä¸ªè¢«æ¨¡æ‹Ÿçš„å‡½æ•°æ—¶ï¼Œå®ƒä¸ä¼šæ‰§è¡Œå…¶åŸå§‹å®ç°ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä½ é€šè¿‡ <code>mockReturnValue</code>æ‰€è®¾ç½®çš„å€¼ã€‚è¿™åœ¨æµ‹è¯•ä¸­éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ä½ éš”ç¦»è¢«æµ‹ä»£ç ï¼Œä¸“æ³¨äºæµ‹è¯•å…¶é€»è¾‘ï¼Œè€Œä¸å¿…å…³å¿ƒå…¶ä¾èµ–ï¼ˆå¦‚ EChartsã€ç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“ç­‰ï¼‰çš„çœŸå®å®ç°å’Œå‰¯ä½œç”¨ã€‚</p><p>ä¸€ä¸ªåŸºæœ¬ç”¨æ³•å¦‚ä¸‹ï¼š</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token keyword">const</span> myMock <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// è®¾ç½®æ¨¡æ‹Ÿå‡½æ•°çš„è¿”å›å€¼ä¸º 42</span></span>
<span class="line">myMock<span class="token punctuation">.</span><span class="token function">mockReturnValue</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">myMock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¾“å‡º 42</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>myMock</code>è¢«è°ƒç”¨æ—¶è¿”å›äº†é¢„è®¾çš„å€¼ <code>42</code>ã€‚</p><h5 id="ğŸ”-ä»£ç é€è¡Œè§£æ" tabindex="-1"><a class="header-anchor" href="#ğŸ”-ä»£ç é€è¡Œè§£æ"><span>ğŸ” ä»£ç é€è¡Œè§£æ</span></a></h5><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç»“åˆä½ çš„ä»£ç ç‰‡æ®µæ¥æ·±å…¥ç†è§£ï¼š</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line">mockChartInstance <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  setOption<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token comment">// æ¨¡æ‹Ÿ setOption æ–¹æ³•</span></span>
<span class="line">  resize<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>           <span class="token comment">// æ¨¡æ‹Ÿ resize æ–¹æ³•</span></span>
<span class="line">  dispose<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token comment">// æ¨¡æ‹Ÿ dispose æ–¹æ³•</span></span>
<span class="line">  on<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token comment">// æ¨¡æ‹Ÿ on æ–¹æ³•</span></span>
<span class="line">  off<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>             <span class="token comment">// æ¨¡æ‹Ÿ off æ–¹æ³•</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// å‘Šè¯‰ mocked init è¿”å›æˆ‘ä»¬åˆ›å»ºçš„å®ä¾‹</span></span>
<span class="line">vi<span class="token punctuation">.</span><span class="token function">mocked</span><span class="token punctuation">(</span>echarts<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockReturnValue</span><span class="token punctuation">(</span>mockChartInstance <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li><strong>åˆ›å»ºæ¨¡æ‹Ÿçš„å›¾è¡¨å®ä¾‹</strong>ï¼šé¦–å…ˆï¼Œä»£ç åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>mockChartInstance</code>çš„å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡æ¨¡æ‹Ÿäº†ä¸€ä¸ªçœŸå®çš„ ECharts å›¾è¡¨å®ä¾‹ï¼Œå®ƒåŒ…å«äº†å®ä¾‹ä¸Šå¸¸è§çš„æ–¹æ³•ï¼ˆå¦‚ <code>setOption</code>, <code>resize</code>ç­‰ï¼‰ï¼Œä½†è¿™äº›æ–¹æ³•éƒ½è¢«æ›¿æ¢æˆäº† <code>vi.fn()</code>ï¼ˆVitest çš„æ¨¡æ‹Ÿå‡½æ•°ï¼‰ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨æµ‹è¯•ä¸­ï¼Œä½ å¯ä»¥è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œä½†å®ƒä»¬ä¸ä¼šæ‰§è¡Œä»»ä½•å®é™…æ“ä½œï¼Œåªæ˜¯è®°å½•è‡ªå·±è¢«è°ƒç”¨è¿‡ã€‚</li><li><strong>ä½¿ç”¨ <code>mockReturnValue</code></strong>ï¼šæ¥ä¸‹æ¥æ˜¯å…³é”®çš„ä¸€è¡Œï¼š<code>vi.mocked(echarts.init).mockReturnValue(mockChartInstance as any);</code>ã€‚ <code>vi.mocked(echarts.init)</code>ï¼š<code>vi.mocked()</code>æ˜¯ Vitest æä¾›çš„ä¸€ä¸ªå·¥å…·å‡½æ•°ï¼Œå®ƒç”¨äºä¸ºä¸€ä¸ªå·²ç»è¢«æ¨¡æ‹Ÿï¼ˆmockï¼‰çš„å‡½æ•°æˆ–æ¨¡å—æ·»åŠ ç±»å‹å®šä¹‰ï¼Œè®©ä½ èƒ½å¤Ÿå®‰å…¨åœ°è®¿é—®å…¶æ‰€æœ‰æ¨¡æ‹Ÿç›¸å…³çš„æ–¹æ³•ï¼ˆå¦‚ <code>mockReturnValue</code>ï¼‰è€Œä¸ä¼šå¼•å‘ TypeScript ç±»å‹é”™è¯¯ã€‚è¿™é‡Œå®ƒå¤„ç†çš„æ˜¯ <code>echarts.init</code>æ–¹æ³•ã€‚ <code>.mockReturnValue(mockChartInstance as any)</code>ï¼šè¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯<strong>è®¾ç½® <code>echarts.init</code>è¿™ä¸ªæ¨¡æ‹Ÿå‡½æ•°çš„è¿”å›å€¼</strong>ã€‚ç°åœ¨ï¼Œå½“ä½ çš„ç»„ä»¶æˆ–å‡½æ•°åœ¨æµ‹è¯•ä¸­è°ƒç”¨ <code>echarts.init(someDomElement)</code>æ—¶ï¼Œå®ƒä¸ä¼šå»åˆå§‹åŒ–ä¸€ä¸ªçœŸå®çš„ ECharts å›¾è¡¨ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä½ é¢„å…ˆå‡†å¤‡å¥½çš„ã€å®Œå…¨å—æ§çš„ <code>mockChartInstance</code>å¯¹è±¡ã€‚</li></ol><h5 id="ğŸ’¡-ä¸ºä»€ä¹ˆè¿™æ ·åš" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-ä¸ºä»€ä¹ˆè¿™æ ·åš"><span>ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·åšï¼Ÿ</span></a></h5><p>è¿™ç§åšæ³•çš„å¥½å¤„éå¸¸æ˜æ˜¾ï¼š</p><ul><li><p><strong>éš”ç¦»æµ‹è¯•</strong>ï¼šä½ çš„æµ‹è¯•ä¸å†ä¾èµ–äº ECharts åº“çš„å†…éƒ¨å®ç°å’Œæµè§ˆå™¨ç¯å¢ƒã€‚å³ä½¿ ECharts æœ¬èº«æœ‰ bug æˆ–è€…éœ€è¦å¤æ‚çš„ DOM ç¯å¢ƒï¼Œä½ çš„å•å…ƒæµ‹è¯•ä¹Ÿèƒ½æ­£å¸¸è¿›è¡Œã€‚</p></li><li><p><strong>æ§åˆ¶ä¸éªŒè¯</strong>ï¼šä½ å¯ä»¥è½»æ¾åœ°éªŒè¯ä½ çš„ç»„ä»¶æ˜¯å¦æ­£ç¡®åœ°ä¸ ECharts å®ä¾‹è¿›è¡Œäº†äº¤äº’ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ–­è¨€ <code>mockChartInstance.setOption</code>æ˜¯å¦è¢«è°ƒç”¨ï¼Œä»¥åŠè¢«è°ƒç”¨æ—¶ä¼ å…¥äº†å“ªäº›å‚æ•°ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// åœ¨æµ‹è¯•ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·éªŒè¯</span></span>
<span class="line"><span class="token function">expect</span><span class="token punctuation">(</span>mockChartInstance<span class="token punctuation">.</span>setOption<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  title<span class="token operator">:</span> <span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">&#39;æµ‹è¯•å›¾è¡¨&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  series<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">,</span> data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>æå‡æµ‹è¯•é€Ÿåº¦å’Œå¯é æ€§</strong>ï¼šé¿å…äº†çœŸå®å›¾è¡¨çš„åˆ›å»ºå’Œæ¸²æŸ“ï¼Œæµ‹è¯•æ‰§è¡Œæ›´å¿«ï¼Œä¸”ç»“æœä¸ä¼šå—ç½‘ç»œã€åŠ¨ç”»ç­‰ä¸ç¡®å®šå› ç´ å½±å“ã€‚</p></li></ul><h5 id="ğŸ“š-å…³è”çš„-mock-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#ğŸ“š-å…³è”çš„-mock-æ–¹æ³•"><span>ğŸ“š å…³è”çš„ Mock æ–¹æ³•</span></a></h5><p><code>mockReturnValue</code>è¿˜æœ‰ä¸€äº›å…³è”æ–¹æ³•ï¼Œç”¨äºæ›´ç²¾ç»†çš„æ§åˆ¶ï¼š</p><ul><li><p><code>mockReturnValueOnce()</code>: åªå¯¹ä¸‹ä¸€æ¬¡è°ƒç”¨è¿”å›æŒ‡å®šå€¼ã€‚å¯ä»¥é“¾å¼è°ƒç”¨ï¼Œä¸ºè¿ç»­è°ƒç”¨è®¾ç½®ä¸åŒçš„è¿”å›å€¼ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"> <span class="token keyword">const</span> myMock <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>	  <span class="token punctuation">.</span><span class="token function">mockReturnValueOnce</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨è¿”å› 10  .mockReturnValueOnce(20) // ç¬¬äºŒæ¬¡è¿”å› 20  .mockReturnValue(30);   // åç»­æ‰€æœ‰è°ƒç”¨è¿”å› 30console.log(myMock(), myMock(), myMock(), myMock()); // è¾“å‡ºï¼š10 20 30 30ts</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><code>mockResolvedValue()</code>: ä¸“é—¨ç”¨äºæ¨¡æ‹Ÿè¿”å›ä¸€ä¸ªæˆåŠŸçš„ Promiseï¼ˆå¼‚æ­¥å‡½æ•°ï¼‰ã€‚</p></li><li><p><code>mockImplementation()</code>: å…è®¸ä½ ä¸ºæ¨¡æ‹Ÿå‡½æ•°æä¾›ä¸€ä¸ªå®Œæ•´çš„è‡ªå®šä¹‰å®ç°ï¼Œè€Œä¸ä»…ä»…æ˜¯è¿”å›å€¼ã€‚</p></li></ul><h5 id="âš ï¸-å…³äºç±»å‹æ–­è¨€-as-any" tabindex="-1"><a class="header-anchor" href="#âš ï¸-å…³äºç±»å‹æ–­è¨€-as-any"><span>âš ï¸ å…³äºç±»å‹æ–­è¨€ <code>as any</code></span></a></h5><p>ä½ ä»£ç ä¸­çš„ <code>as any</code>æ˜¯ä¸€ç§ TypeScript çš„ç±»å‹æ–­è¨€ã€‚å®ƒå‘Šè¯‰ TypeScript ç¼–è¯‘å™¨ï¼šâ€œç›¸ä¿¡æˆ‘ï¼Œè¿™ä¸ªå€¼æ˜¯è¿™ä¸ªç±»å‹â€ã€‚è¿™é‡Œä½¿ç”¨å®ƒé€šå¸¸æ˜¯å› ä¸º <code>mockChartInstance</code>è¿™ä¸ªæ¨¡æ‹Ÿå¯¹è±¡çš„ç»“æ„å¯èƒ½æ— æ³•å®Œå…¨æ»¡è¶³ ECharts å®ä¾‹å¤æ‚çš„ç±»å‹å®šä¹‰ã€‚è¿™æ˜¯ä¸€ç§å¿«é€Ÿç»•è¿‡ç±»å‹æ£€æŸ¥çš„æ–¹æ³•ï¼Œä½†åœ¨æ›´ä¸¥è°¨çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ›´ç²¾ç¡®çš„ç±»å‹å®šä¹‰æˆ–æ›´å®Œå–„çš„æ¨¡æ‹Ÿã€‚</p><p>ä¸ºäº†æ›´æ¸…æ™°åœ°ç†è§£è¿™äº›æ–¹æ³•çš„ä¸åŒç”¨é€”ï¼Œå¯ä»¥å‚è€ƒä¸‹è¡¨ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>ä¸»è¦ç”¨é€”</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong><code>mockReturnValue</code></strong></td><td>è®¾ç½®æ¨¡æ‹Ÿå‡½æ•°çš„<strong>å›ºå®šåŒæ­¥è¿”å›å€¼</strong></td><td>æ¨¡æ‹ŸåŒæ­¥å‡½æ•°è°ƒç”¨ï¼Œå¦‚ <code>echarts.init</code></td></tr><tr><td><strong><code>mockReturnValueOnce</code></strong></td><td>è®¾ç½®æ¨¡æ‹Ÿå‡½æ•°<strong>å•æ¬¡</strong>è°ƒç”¨çš„åŒæ­¥è¿”å›å€¼</td><td>æ¨¡æ‹Ÿéœ€è¦è¿”å›ä¸åŒå€¼çš„è¿ç»­è°ƒç”¨</td></tr><tr><td><strong><code>mockResolvedValue</code></strong></td><td>è®¾ç½®æ¨¡æ‹Ÿå‡½æ•°è¿”å›ä¸€ä¸ª<strong>å·²è§£å†³çš„ Promise</strong></td><td>æ¨¡æ‹Ÿå¼‚æ­¥å‡½æ•°æˆåŠŸè¿”å›çš„æƒ…å†µ</td></tr><tr><td><strong><code>mockImplementation</code></strong></td><td>æä¾›æ¨¡æ‹Ÿå‡½æ•°çš„<strong>å®Œæ•´è‡ªå®šä¹‰å®ç°</strong></td><td>å½“éœ€è¦æ ¹æ®è¾“å…¥å‚æ•°åŠ¨æ€å†³å®šè¿”å›å€¼æˆ–æ‰§è¡Œé€»è¾‘æ—¶</td></tr></tbody></table><p>å¸Œæœ›è¿™äº›è§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ <code>mockReturnValue</code>ä»¥åŠå¦‚ä½•åœ¨æµ‹è¯•ä¸­æœ‰æ•ˆåœ°ä½¿ç”¨æ¨¡æ‹Ÿå‡½æ•°ï¼</p><h5 id="ğŸ¯-å®é™…åº”ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-å®é™…åº”ç”¨åœºæ™¯"><span>ğŸ¯ å®é™…åº”ç”¨åœºæ™¯</span></a></h5><h4 id="åœºæ™¯1-æ¨¡æ‹Ÿ-api-è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯1-æ¨¡æ‹Ÿ-api-è°ƒç”¨"><span>åœºæ™¯1ï¼šæ¨¡æ‹Ÿ API è°ƒç”¨</span></a></h4><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// userService.test.js</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> vi<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchUser<span class="token punctuation">,</span> createUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./userService&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ¨¡æ‹Ÿ API æ¨¡å—</span></span>
<span class="line">vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#39;./api&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  http<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    get<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    post<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> http <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./api&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;ç”¨æˆ·æœåŠ¡æµ‹è¯•&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;æˆåŠŸè·å–ç”¨æˆ·&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ¨¡æ‹ŸæˆåŠŸå“åº”</span></span>
<span class="line">    http<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> </span>
<span class="line">      data<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">&#39;å¼ ä¸‰&#39;</span> <span class="token punctuation">}</span> </span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>get<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">&#39;/users/1&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">&#39;å¼ ä¸‰&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;å¤„ç†APIé”™è¯¯&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ¨¡æ‹Ÿé”™è¯¯å“åº”</span></span>
<span class="line">    http<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockRejectedValue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;ç½‘ç»œé”™è¯¯&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchUser</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span><span class="token string">&#39;ç½‘ç»œé”™è¯¯&#39;</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="åœºæ™¯2-æµ‹è¯•-vue-ç»„ä»¶ä¸­çš„å¼‚æ­¥æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯2-æµ‹è¯•-vue-ç»„ä»¶ä¸­çš„å¼‚æ­¥æ“ä½œ"><span>åœºæ™¯2ï¼šæµ‹è¯• Vue ç»„ä»¶ä¸­çš„å¼‚æ­¥æ“ä½œ</span></a></h4><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// UserComponent.test.js</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> vi<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@vue/test-utils&#39;</span></span>
<span class="line"><span class="token keyword">import</span> UserComponent <span class="token keyword">from</span> <span class="token string">&#39;./UserComponent.vue&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> fetchUser <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./userService&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ¨¡æ‹Ÿç”¨æˆ·æœåŠ¡</span></span>
<span class="line">vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#39;./userService&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;UserComponent&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;ç»„ä»¶åŠ è½½æ—¶åº”è¯¥è·å–ç”¨æˆ·æ•°æ®&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// æ¨¡æ‹Ÿå¼‚æ­¥å‡½æ•°è¿”å›</span></span>
<span class="line">    fetchUser<span class="token punctuation">.</span><span class="token function">mockResolvedValue</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;æå››&#39;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">mount</span><span class="token punctuation">(</span>UserComponent<span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment">// ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ</span></span>
<span class="line">    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Promise</span></span><span class="token punctuation">(</span>resolve <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">&#39;æå››&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>fetchUser<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="åœºæ™¯3-æ¨¡æ‹Ÿç¬¬ä¸‰æ–¹åº“" tabindex="-1"><a class="header-anchor" href="#åœºæ™¯3-æ¨¡æ‹Ÿç¬¬ä¸‰æ–¹åº“"><span>åœºæ™¯3ï¼šæ¨¡æ‹Ÿç¬¬ä¸‰æ–¹åº“</span></a></h4><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// chartUtils.test.js</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> vi<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ¨¡æ‹Ÿ echarts</span></span>
<span class="line">vi<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">&#39;echarts&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  init<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    setOption<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    resize<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    dispose<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> echarts <span class="token keyword">from</span> <span class="token string">&#39;echarts&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> initChart <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./chartUtils&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;å›¾è¡¨å·¥å…·æµ‹è¯•&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;åº”è¯¥æ­£ç¡®åˆå§‹åŒ–å›¾è¡¨&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">initChart</span><span class="token punctuation">(</span>div<span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">    </span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>echarts<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ğŸ’¡-æœ€ä½³å®è·µå»ºè®®" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-æœ€ä½³å®è·µå»ºè®®"><span>ğŸ’¡ æœ€ä½³å®è·µå»ºè®®</span></a></h3><ol><li><strong>åŠæ—¶æ¸…ç†æ¨¡æ‹Ÿ</strong>ï¼šåœ¨æ¯ä¸ªæµ‹è¯•åä½¿ç”¨ <code>vi.clearAllMocks()</code>æˆ– <code>mockFn.mockClear()</code>æ¸…ç†æ¨¡æ‹ŸçŠ¶æ€ï¼Œé¿å…æµ‹è¯•é—´ç›¸äº’å½±å“ã€‚</li><li><strong>ä¼˜å…ˆä½¿ç”¨ <code>vi.spyOn()</code></strong>ï¼šå½“åªéœ€è¦éªŒè¯æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨æ—¶ï¼Œä½¿ç”¨ <code>spyOn</code>è€Œä¸æ˜¯å®Œå…¨æ¨¡æ‹Ÿï¼Œè¿™æ ·å¯ä»¥ä¿ç•™åŸå§‹å®ç°ã€‚</li><li><strong>åˆç†ç»„ç»‡æ¨¡æ‹Ÿä»£ç </strong>ï¼šå°†å¤æ‚çš„æ¨¡æ‹Ÿé€»è¾‘æ”¾åœ¨ <code>beforeEach</code>æˆ–å•ç‹¬çš„è¾…åŠ©å‡½æ•°ä¸­ï¼Œä¿æŒæµ‹è¯•ä»£ç æ•´æ´ã€‚</li><li><strong>é¿å…è¿‡åº¦æ¨¡æ‹Ÿ</strong>ï¼šåªæ¨¡æ‹Ÿå¿…è¦çš„ä¾èµ–ï¼Œè®©æµ‹è¯•å°½å¯èƒ½æ¥è¿‘çœŸå®ç¯å¢ƒã€‚</li></ol><p>é€šè¿‡è¿™äº› Mock API çš„çµæ´»è¿ç”¨ï¼Œä½ å¯ä»¥æœ‰æ•ˆåœ°éš”ç¦»æµ‹è¯•ç›®æ ‡ï¼Œåˆ›å»ºç¨³å®šå¯é çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p><h3 id="puls-å¯è·Ÿè¸ª" tabindex="-1"><a class="header-anchor" href="#puls-å¯è·Ÿè¸ª"><span>Puls:å¯è·Ÿè¸ª</span></a></h3><p>åœ¨ Vitest çš„æµ‹è¯•è¯­å¢ƒä¸­ï¼Œâ€œ<strong>å¯è·Ÿè¸ª</strong>â€æŒ‡çš„æ˜¯æ¨¡æ‹Ÿå‡½æ•°ï¼ˆMock Functionï¼‰å…·å¤‡çš„ä¸€ç§æ ¸å¿ƒèƒ½åŠ›ï¼šå®ƒèƒ½å¤Ÿè‡ªåŠ¨ã€è¯¦ç»†åœ°è®°å½•ä¸‹å…³äºè‡ªèº«è¢«è°ƒç”¨çš„æ‰€æœ‰å…³é”®ä¿¡æ¯ã€‚è¿™å°±åƒä¸€ä¸ªå†…ç½®çš„â€œé£è¡Œè®°å½•ä»ªâ€æˆ–â€œç›‘æ§æ‘„åƒå¤´â€ï¼Œè®©ä½ èƒ½åœ¨æµ‹è¯•ç»“æŸåï¼Œç²¾ç¡®åœ°å›æ”¾å’ŒæŸ¥éªŒè¿™ä¸ªå‡½æ•°ç©¶ç«Ÿæ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚</p><h4 id="ğŸ”-å…·ä½“è·Ÿè¸ªå“ªäº›ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#ğŸ”-å…·ä½“è·Ÿè¸ªå“ªäº›ä¿¡æ¯"><span>ğŸ” å…·ä½“è·Ÿè¸ªå“ªäº›ä¿¡æ¯</span></a></h4><p>ä¸€ä¸ªè¢«è®¾ç½®ä¸ºå¯è·Ÿè¸ªçš„æ¨¡æ‹Ÿå‡½æ•°ï¼ˆé€šå¸¸é€šè¿‡ <code>vi.fn()</code>åˆ›å»ºï¼‰ï¼Œä¸»è¦ä¼šè®°å½•ä»¥ä¸‹å‡ ç±»ä¿¡æ¯ï¼š</p><table><thead><tr><th>è·Ÿè¸ªçš„ä¿¡æ¯</th><th>è¯´æ˜</th><th>æµ‹è¯•ä¸­å¸¸ç”¨çš„éªŒè¯æ–¹æ³•</th></tr></thead><tbody><tr><td><strong>æ˜¯å¦è¢«è°ƒç”¨</strong></td><td>è®°å½•å‡½æ•°æ˜¯å¦è¢«è°ƒç”¨è¿‡ï¼Œä»¥åŠè¢«è°ƒç”¨çš„æ€»æ¬¡æ•°ã€‚</td><td><code>.toHaveBeenCalled()\`\`.toHaveBeenCalledTimes(n)</code></td></tr><tr><td><strong>è°ƒç”¨æ—¶çš„å‚æ•°</strong></td><td>è®°å½•æ¯æ¬¡è°ƒç”¨æ—¶ï¼Œä¼ å…¥çš„å…·ä½“å‚æ•°æ˜¯ä»€ä¹ˆã€‚</td><td><code>.toHaveBeenCalledWith(arg1, arg2...)</code></td></tr><tr><td><strong>è¿”å›å€¼</strong></td><td>è®°å½•å‡½æ•°æ¯æ¬¡è°ƒç”¨åè¿”å›äº†ä»€ä¹ˆå€¼ã€‚</td><td><code>.toHaveReturnedWith(value)</code></td></tr><tr><td><strong>è°ƒç”¨ä¸Šä¸‹æ–‡</strong></td><td>è®°å½•å‡½æ•°è¢«è°ƒç”¨æ—¶ <code>this</code>çš„æŒ‡å‘ã€‚</td><td>é€šè¿‡è®¿é—® mock å±æ€§æŸ¥çœ‹</td></tr><tr><td><strong>è°ƒç”¨é¡ºåº</strong></td><td>å½“å¤šä¸ªæ¨¡æ‹Ÿå‡½æ•°å­˜åœ¨æ—¶ï¼Œå¯ä»¥ç»“åˆå…¶ä»–å·¥å…·éªŒè¯å…¶è°ƒç”¨é¡ºåºã€‚</td><td>-</td></tr></tbody></table><h4 id="ğŸ’¡-ä¸ºä»€ä¹ˆ-å¯è·Ÿè¸ª-å¾ˆé‡è¦" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-ä¸ºä»€ä¹ˆ-å¯è·Ÿè¸ª-å¾ˆé‡è¦"><span>ğŸ’¡ ä¸ºä»€ä¹ˆâ€œå¯è·Ÿè¸ªâ€å¾ˆé‡è¦</span></a></h4><p>è¿™ç§å¯è·Ÿè¸ªçš„ç‰¹æ€§æ˜¯å•å…ƒæµ‹è¯•èƒ½å¤Ÿ<strong>éš”ç¦»</strong>å’Œ<strong>ç²¾ç¡®æ–­è¨€</strong>çš„å…³é”®ã€‚å®ƒå…è®¸ä½ å°†æµ‹è¯•ç„¦ç‚¹å®Œå…¨æ”¾åœ¨è¢«æµ‹è¯•çš„ä»£ç å•å…ƒä¸Šï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…¶å†…éƒ¨ä¾èµ–çš„å‡½æ•°çš„å…·ä½“å®ç°ã€‚ä½ åªéœ€è¦æ–­è¨€ï¼šâ€œæˆ‘æœŸæœ›è¿™ä¸ªä¾èµ–å‡½æ•°è¢«ä»¥æŸç§ç‰¹å®šæ–¹å¼è°ƒç”¨â€ï¼Œç„¶åé€šè¿‡å¯è·Ÿè¸ªçš„æ¨¡æ‹Ÿå‡½æ•°æ¥éªŒè¯è¿™ä¸€æœŸæœ›æ˜¯å¦è¾¾æˆã€‚</p><h4 id="ğŸ› ï¸-ç®€å•ä»£ç ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ğŸ› ï¸-ç®€å•ä»£ç ç¤ºä¾‹"><span>ğŸ› ï¸ ç®€å•ä»£ç ç¤ºä¾‹</span></a></h4><p>ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•åˆ©ç”¨å¯è·Ÿè¸ªçš„æ¨¡æ‹Ÿå‡½æ•°è¿›è¡Œæµ‹è¯•ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> vi<span class="token punctuation">,</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// ä¸€ä¸ªå¾…æµ‹è¯•çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">doSomethingAndCallBack</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// ä¸€äº›ä¸šåŠ¡é€»è¾‘...</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>isValid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token string">&#39;success&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åœ¨ç‰¹å®šæ¡ä»¶ä¸‹è°ƒç”¨å›è°ƒå‡½æ•°</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;å¯è·Ÿè¸ªçš„æ¨¡æ‹Ÿå‡½æ•°&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;åº”è¯¥æ­£ç¡®è®°å½•å›è°ƒå‡½æ•°çš„è°ƒç”¨æƒ…å†µ&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 1. åˆ›å»ºä¸€ä¸ªå¯è·Ÿè¸ªçš„æ¨¡æ‹Ÿå‡½æ•°æ¥æ¨¡æ‹Ÿå›è°ƒ</span></span>
<span class="line">    <span class="token keyword">const</span> mockCallback <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span>
<span class="line">	</span>
<span class="line">    <span class="token comment">// 2. æ‰§è¡Œè¢«æµ‹å‡½æ•°ï¼Œå¹¶ä¼ å…¥æ¨¡æ‹Ÿå›è°ƒ</span></span>
<span class="line">    <span class="token function">doSomethingAndCallBack</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">isValid</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> mockCallback<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 3. åˆ©ç”¨å¯è·Ÿè¸ªæ€§è¿›è¡Œæ–­è¨€</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>mockCallback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–­è¨€å›è°ƒå‡½æ•°è¢«è°ƒç”¨äº†</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>mockCallback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–­è¨€å›è°ƒå‡½æ•°è¢«è°ƒç”¨äº†ä¸€æ¬¡</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>mockCallback<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span><span class="token string">&#39;success&#39;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–­è¨€å›è°ƒå‡½æ•°è¢«è°ƒç”¨æ—¶ä¼ å…¥äº†æ­£ç¡®çš„å‚æ•°</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ’-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ’-æ€»ç»“"><span>ğŸ’ æ€»ç»“</span></a></h4><p>ç®€å•æ¥è¯´ï¼Œåœ¨æµ‹è¯•ä¸­ï¼Œâ€œå¯è·Ÿè¸ªâ€å°±æ˜¯ç»™å‡½æ•°è£…ä¸Šâ€œç›‘æ§â€ï¼Œè®©å®ƒèƒ½<strong>è‡ªåŠ¨è®°å½•ä¸‹è‡ªå·±çš„æ¯ä¸€æ¬¡è¡ŒåŠ¨</strong>ã€‚æµ‹è¯•è€…åˆ™å¯ä»¥ä¾æ®è¿™äº›è¯¦ç»†çš„â€œè¡ŒåŠ¨è®°å½•â€ï¼ˆè°ƒç”¨ä¿¡æ¯ï¼‰ï¼Œæ¥éªŒè¯ä»£ç çš„è¡Œä¸ºæ˜¯å¦å®Œå…¨ç¬¦åˆé¢„æœŸï¼Œä»è€Œä¿è¯æµ‹è¯•çš„<strong>ç²¾å‡†æ€§å’Œå¯é æ€§</strong>ã€‚</p><p>å¸Œæœ›è¿™ä¸ªè§£é‡Šèƒ½å¸®ä½ æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ¦‚å¿µï¼</p><h2 id="è¦†ç›–ç‡æŠ¥å‘Š" tabindex="-1"><a class="header-anchor" href="#è¦†ç›–ç‡æŠ¥å‘Š"><span>è¦†ç›–ç‡æŠ¥å‘Š</span></a></h2><p>Vitest çš„é…ç½®æ˜¯å…¶å¼ºå¤§åŠŸèƒ½çš„æ ¸å¿ƒï¼Œæ­£ç¡®çš„é…ç½®èƒ½æ˜¾è‘—æå‡æµ‹è¯•æ•ˆç‡ä¸å¼€å‘ä½“éªŒã€‚ä¸‹é¢è¿™ä¸ªè¡¨æ ¼æ±‡æ€»äº†å…¶æ ¸å¿ƒé…ç½®é¡¹ï¼Œæ–¹ä¾¿ä½ å¿«é€ŸæŸ¥é˜…ã€‚</p><table><thead><tr><th style="text-align:left;">é…ç½®ç±»åˆ«</th><th style="text-align:left;">æ ¸å¿ƒé…ç½®é¡¹</th><th style="text-align:left;">å¸¸ç”¨å€¼ç¤ºä¾‹</th><th style="text-align:left;">ä¸»è¦ä½œç”¨</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>ç¯å¢ƒä¸å…¨å±€è®¾ç½®</strong></td><td style="text-align:left;"><code>environment</code></td><td style="text-align:left;"><code>jsdom</code>, <code>happy-dom</code>, <code>node</code></td><td style="text-align:left;">è®¾ç½®æµ‹è¯•è¿è¡Œç¯å¢ƒï¼Œæ¨¡æ‹Ÿæµè§ˆå™¨æˆ–Node.js</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>globals</code></td><td style="text-align:left;"><code>true</code>, <code>false</code></td><td style="text-align:left;">æ˜¯å¦å…¨å±€æ³¨å…¥<code>describe</code>, <code>it</code>, <code>expect</code>ç­‰APIï¼Œç®€åŒ–å¯¼å…¥</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>setupFiles</code></td><td style="text-align:left;"><code>./tests/setup.ts</code></td><td style="text-align:left;">æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨æµ‹è¯•è¿è¡Œå‰æ‰§è¡Œå…¨å±€åˆå§‹åŒ–ä»£ç </td></tr><tr><td style="text-align:left;"><strong>æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œ</strong></td><td style="text-align:left;"><code>include</code></td><td style="text-align:left;"><code>[&#39;**/*.{test,spec}.{js,ts}&#39;]</code></td><td style="text-align:left;">å®šä¹‰å“ªäº›æ–‡ä»¶è¢«è¯†åˆ«ä¸ºæµ‹è¯•æ–‡ä»¶</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>exclude</code></td><td style="text-align:left;"><code>[&#39;node_modules&#39;]</code></td><td style="text-align:left;">æ’é™¤ä¸éœ€è¦æµ‹è¯•çš„æ–‡ä»¶æˆ–ç›®å½•</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>watch</code></td><td style="text-align:left;"><code>true</code>, <code>false</code></td><td style="text-align:left;">æ˜¯å¦å¯ç”¨ç›‘å¬æ¨¡å¼ï¼Œæ–‡ä»¶å˜æ›´æ—¶è‡ªåŠ¨é‡æ–°è¿è¡Œç›¸å…³æµ‹è¯•</td></tr><tr><td style="text-align:left;"><strong>è¦†ç›–ç‡æŠ¥å‘Š</strong></td><td style="text-align:left;"><code>coverage</code></td><td style="text-align:left;"><code>{ reporter: [&#39;html&#39;, &#39;text&#39;] }</code></td><td style="text-align:left;">é…ç½®è¦†ç›–ç‡å·¥å…·ï¼Œç”Ÿæˆå¤šç§æ ¼å¼çš„æŠ¥å‘Š</td></tr><tr><td style="text-align:left;"><strong>æ¨¡æ‹Ÿä¸åˆ«å</strong></td><td style="text-align:left;"><code>alias</code></td><td style="text-align:left;"><code>{ &#39;@&#39;: &#39;/src&#39; }</code></td><td style="text-align:left;">è®¾ç½®è·¯å¾„åˆ«åï¼Œä¸Viteé¡¹ç›®é…ç½®ä¿æŒä¸€è‡´</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"><code>restoreMocks</code></td><td style="text-align:left;"><code>true</code>, <code>false</code></td><td style="text-align:left;">æ˜¯å¦åœ¨æ¯ä¸ªæµ‹è¯•åè‡ªåŠ¨é‡ç½®æ‰€æœ‰æ¨¡æ‹Ÿï¼ˆmockï¼‰</td></tr></tbody></table><h3 id="ğŸ’»-ç¯å¢ƒä¸å…¨å±€è®¾ç½®-1" tabindex="-1"><a class="header-anchor" href="#ğŸ’»-ç¯å¢ƒä¸å…¨å±€è®¾ç½®-1"><span>ğŸ’» ç¯å¢ƒä¸å…¨å±€è®¾ç½®</span></a></h3><p>è¿™æ˜¯é…ç½®çš„åŸºçŸ³ï¼Œå†³å®šäº†æµ‹è¯•ä»£ç çš„è¿è¡Œä¸Šä¸‹æ–‡ã€‚</p><ul><li><p><strong><code>environment</code>ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰</strong>ï¼šè¿™æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªé…ç½®ã€‚</p><ul><li><strong><code>jsdom</code>/ <code>happy-dom</code></strong>ï¼šå½“æµ‹è¯•<strong>Vueã€Reactç­‰ç»„ä»¶</strong>æ—¶ï¼Œéœ€è¦æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼ˆå¦‚<code>window</code>, <code>document</code>å¯¹è±¡ï¼‰ã€‚<code>jsdom</code>æ˜¯åŠŸèƒ½å…¨é¢çš„æ ‡å‡†é€‰æ‹©ï¼Œè€Œ<code>happy-dom</code>åœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½æ›´å¿« ã€‚</li><li><strong><code>node</code></strong>ï¼šå¦‚æœæµ‹è¯•çš„æ˜¯<strong>çº¯Node.jsåç«¯é€»è¾‘æˆ–å·¥å…·å‡½æ•°</strong>ï¼Œåˆ™åº”é€‰æ‹©æ­¤ç¯å¢ƒ ã€‚</li></ul><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// vite.config.ts / vitest.config.ts</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  test<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    environment<span class="token operator">:</span> <span class="token string">&#39;jsdom&#39;</span><span class="token punctuation">,</span> <span class="token comment">// ä¸ºç»„ä»¶æµ‹è¯•å¯ç”¨æµè§ˆå™¨ç¯å¢ƒæ¨¡æ‹Ÿ</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>globals</code>ï¼ˆå…¨å±€APIï¼‰</strong>ï¼šè®¾ç½®ä¸º<code>true</code>åï¼Œä½ å¯ä»¥åœ¨æµ‹è¯•æ–‡ä»¶ä¸­ç›´æ¥ä½¿ç”¨<code>describe</code>, <code>it</code>, <code>expect</code>ç­‰å‡½æ•°ï¼Œè€Œæ— éœ€åœ¨æ¯ä¸ªæ–‡ä»¶é‡Œå•ç‹¬å¯¼å…¥ï¼Œè®©ä»£ç æ›´ç®€æ´</p><p>ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// å½“ globals: true æ—¶ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</span></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;my test suite&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should work&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// å¦åˆ™ï¼Œéœ€è¦ä» &#39;vitest&#39; æ˜¾å¼å¯¼å…¥ï¼š</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> describe<span class="token punctuation">,</span> it<span class="token punctuation">,</span> expect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong><code>setupFiles</code>ï¼ˆè®¾ç½®æ–‡ä»¶ï¼‰</strong>ï¼šç”¨äºæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªåœ¨æ¯ä¸ªæµ‹è¯•è¿è¡Œ<strong>ä¹‹å‰</strong>ä¼šæ‰§è¡Œçš„è„šæœ¬ã€‚é€šå¸¸åœ¨è¿™é‡Œè¿›è¡Œå…¨å±€çš„æµ‹è¯•ç¯å¢ƒè®¾ç½®ï¼Œä¾‹å¦‚é…ç½®æµ‹è¯•åº“ã€æ¨¡æ‹Ÿå…¨å±€å˜é‡æˆ–åˆå§‹åŒ–æ•°æ®åº“è¿æ¥</p><p>ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// vitest.config.ts</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  test<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    setupFiles<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;./tests/setup.ts&#39;</span><span class="token punctuation">]</span> <span class="token comment">// æŒ‡å‘ä½ çš„è®¾ç½®æ–‡ä»¶</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// tests/setup.ts ç¤ºä¾‹ï¼šæ‰©å±•æ–­è¨€ã€è®¾ç½®å…¨å±€æ¨¡æ‹Ÿ</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token string">&#39;@testing-library/jest-dom/vitest&#39;</span> <span class="token comment">// æ‰©å±•äº†å¦‚.toBeInTheDocument()ç­‰DOMæ–­è¨€</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ¨¡æ‹Ÿå…¨å±€å‡½æ•°ï¼Œå¦‚æµè§ˆå™¨API</span></span>
<span class="line">window<span class="token punctuation">.</span>matchMedia <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span>query <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  matches<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  media<span class="token operator">:</span> query<span class="token punctuation">,</span></span>
<span class="line">  onchange<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">  addListener<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// åºŸå¼ƒ</span></span>
<span class="line">  removeListener<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// åºŸå¼ƒ</span></span>
<span class="line">  addEventListener<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  removeEventListener<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  dispatchEvent<span class="token operator">:</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="ğŸ”-æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œæ§åˆ¶-1" tabindex="-1"><a class="header-anchor" href="#ğŸ”-æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œæ§åˆ¶-1"><span>ğŸ” æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œæ§åˆ¶</span></a></h3><p>è¿™äº›é…ç½®æ§åˆ¶ç€å“ªäº›æµ‹è¯•ä¼šè¢«æ‰§è¡Œä»¥åŠå¦‚ä½•æ‰§è¡Œã€‚</p><ul><li><p><strong><code>include</code>/ <code>exclude</code></strong>ï¼šä½¿ç”¨å…¨å±€æ¨¡å¼æ¥å‘Šè¯‰Vitestå“ªäº›æ–‡ä»¶æ˜¯æµ‹è¯•æ–‡ä»¶ã€‚é€šå¸¸è®¾ç½®ä¸ºåŒ¹é…å¦‚<code>**/*.{test,spec}.{js,ts,jsx,tsx}</code>çš„æ¨¡å¼ï¼Œå¹¶æ’é™¤<code>node_modules</code>ç­‰ç›®å½•</p><p>ã€‚</p></li><li><p><strong><code>watch</code>ï¼ˆç›‘å¬æ¨¡å¼ï¼‰</strong>ï¼šåœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°†æ­¤é€‰é¡¹è®¾ç½®ä¸º<code>true</code>ï¼ˆæˆ–ç›´æ¥ä½¿ç”¨<code>vitest</code>å‘½ä»¤ï¼Œå› ä¸ºwatchæ¨¡å¼é»˜è®¤å¼€å¯ï¼‰éå¸¸æœ‰ç”¨ã€‚å½“ä½ ä¿®æ”¹æºä»£ç æˆ–æµ‹è¯•æ–‡ä»¶æ—¶ï¼ŒVitestä¼šè‡ªåŠ¨é‡æ–°è¿è¡Œç›¸å…³çš„æµ‹è¯•ï¼Œæä¾›å³æ—¶åé¦ˆ</p><p>ã€‚</p></li></ul><h3 id="ğŸ“Š-è¦†ç›–ç‡æŠ¥å‘Š-1" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-è¦†ç›–ç‡æŠ¥å‘Š-1"><span>ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Š</span></a></h3><p>è¦†ç›–ç‡å·¥å…·å¸®åŠ©ä½ äº†è§£æµ‹è¯•æ˜¯å¦å…¨é¢è¦†ç›–äº†ä¸šåŠ¡ä»£ç ã€‚</p><ul><li><p><strong><code>coverage</code>ï¼ˆè¦†ç›–ç‡é…ç½®ï¼‰</strong>ï¼šéœ€è¦å…ˆå®‰è£…è¦†ç›–ç‡ä¾èµ–ï¼ˆå¦‚<code>@vitest/coverage-v8</code>ï¼‰ã€‚å¯ç”¨åï¼ŒVitestä¼šåˆ†ææµ‹è¯•æ‰§è¡Œè¿‡ç¨‹ä¸­å“ªäº›ä»£ç è¡Œã€å‡½æ•°ã€åˆ†æ”¯å’Œè¯­å¥è¢«è¦†ç›–åˆ°äº†</p><p>ã€‚</p><div class="language-cmd line-numbers-mode" data-highlighter="prismjs" data-ext="cmd"><pre><code><span class="line"># å®‰è£…è¦†ç›–ç‡å·¥å…·</span>
<span class="line">npm install -D @vitest/coverage-v8</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// vitest.config.ts</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  test<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    coverage<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      provider<span class="token operator">:</span> <span class="token string">&#39;v8&#39;</span><span class="token punctuation">,</span> <span class="token comment">// æˆ– &#39;istanbul&#39;</span></span>
<span class="line">      reporter<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;text&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;html&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;json&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// åœ¨æ§åˆ¶å°ã€HTMLæ–‡ä»¶ç­‰å¤šç§æ ¼å¼è¾“å‡ºæŠ¥å‘Š</span></span>
<span class="line">      reportsDirectory<span class="token operator">:</span> <span class="token string">&#39;./coverage&#39;</span><span class="token punctuation">,</span> <span class="token comment">// æŠ¥å‘Šè¾“å‡ºç›®å½•</span></span>
<span class="line">      exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;tests/**&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// æ’é™¤æµ‹è¯•æ–‡ä»¶æœ¬èº«</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œ<code>vitest run --coverage</code>å³å¯ç”ŸæˆæŠ¥å‘Šã€‚HTMLæŠ¥å‘Šé€šå¸¸æœ€ç›´è§‚ï¼Œå¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°æ¯ä¸ªæ–‡ä»¶çš„è¦†ç›–æƒ…å†µã€‚</p></li></ul><h3 id="ğŸ› ï¸-é«˜çº§ä¸æ¡†æ¶é›†æˆé…ç½®-1" tabindex="-1"><a class="header-anchor" href="#ğŸ› ï¸-é«˜çº§ä¸æ¡†æ¶é›†æˆé…ç½®-1"><span>ğŸ› ï¸ é«˜çº§ä¸æ¡†æ¶é›†æˆé…ç½®</span></a></h3><ul><li><p><strong>è·¯å¾„åˆ«åï¼ˆ<code>alias</code>ï¼‰</strong>ï¼šä¸ºäº†è®©æµ‹è¯•ä¸­çš„æ¨¡å—å¯¼å…¥è·¯å¾„ä¸ä½ çš„Viteé¡¹ç›®é…ç½®ä¿æŒä¸€è‡´ï¼Œéœ€è¦é…ç½®ç›¸åŒçš„åˆ«åã€‚è¿™é€šå¸¸åœ¨Viteçš„<code>resolve.alias</code>ä¸­é…ç½®ï¼ŒVitestä¼šç»§æ‰¿æˆ–éœ€è¦ä½ å•ç‹¬æŒ‡å®š</p><p>ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// vite.config.ts</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span></span>
<span class="line"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&#39;node:path&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  resolve<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    alias<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&#39;@&#39;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  test<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ... å…¶ä»–æµ‹è¯•é…ç½®</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>å¤„ç†CSSç­‰é™æ€èµ„æº</strong>ï¼šåœ¨æµ‹è¯•ä¸­å¼•å…¥CSSæˆ–Vueå•æ–‡ä»¶ç»„ä»¶æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°<code>Unknown file extension</code>é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºVitestéœ€è¦çŸ¥é“å¦‚ä½•å¤„ç†è¿™äº›éJS/TSèµ„æºã€‚è§£å†³æ–¹æ¡ˆæ˜¯ç¡®ä¿å·²å®‰è£…å¹¶é…ç½®äº†å¯¹åº”çš„Viteæ’ä»¶ï¼ˆå¦‚<code>@vitejs/plugin-vue</code>ï¼‰ï¼Œå¹¶ä¸”æµ‹è¯•é…ç½®æ­£ç¡®å…³è”äº†Viteçš„ä¸»é…ç½®</p><p>ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code><span class="line"><span class="token comment">// vitest.config.ts åº”æ­£ç¡®ç»§æ‰¿æˆ–åˆå¹¶ vite.config.ts çš„é…ç½®</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vitest/config&#39;</span></span>
<span class="line"><span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-vue&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ç¡®ä¿å¤„ç†.vueæ–‡ä»¶çš„æ’ä»¶å·²é…ç½®</span></span>
<span class="line">  test<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// ... å…¶ä»–æµ‹è¯•é…ç½®</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>å¸Œæœ›è¿™ä»½è¯¦ç»†çš„é…ç½®è§£è¯»èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°é©¾é©­Vitestï¼å¦‚æœä½ å¯¹æŸä¸ªç‰¹å®šé…ç½®æœ‰æ›´æ·±å…¥çš„ç–‘é—®ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ¢è®¨</p><h1 id="ç»„ä»¶æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#ç»„ä»¶æµ‹è¯•"><span>ç»„ä»¶æµ‹è¯•</span></a></h1><h2 id="ğŸ¯-æµ‹è¯•æ ¸å¿ƒæ€æƒ³" tabindex="-1"><a class="header-anchor" href="#ğŸ¯-æµ‹è¯•æ ¸å¿ƒæ€æƒ³"><span>ğŸ¯ æµ‹è¯•æ ¸å¿ƒæ€æƒ³</span></a></h2><p>Vitest ç»„ä»¶æµ‹è¯•çš„æ ¸å¿ƒæ˜¯éªŒè¯ç»„ä»¶åœ¨å„ç§åœºæ™¯ä¸‹çš„è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚æµ‹è¯•åº”è¯¥å…³æ³¨<strong>ç»„ä»¶åšäº†ä»€ä¹ˆ</strong>ï¼Œè€Œä¸æ˜¯<strong>ç»„ä»¶å¦‚ä½•å®ç°</strong>ã€‚</p><h3 id="æµ‹è¯•é‡‘å­—å¡”åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•é‡‘å­—å¡”åŸåˆ™"><span>æµ‹è¯•é‡‘å­—å¡”åŸåˆ™</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">                                        /      \\</span>
<span class="line">                                       /ç«¯åˆ°ç«¯æµ‹è¯•\\</span>
<span class="line">                                      /  é›†æˆæµ‹è¯•  \\</span>
<span class="line">                                     /   ç»„ä»¶æµ‹è¯•   \\</span>
<span class="line">                                    /    å•å…ƒæµ‹è¯•    \\</span>
<span class="line">                                   /_________________\\</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç»„ä»¶æµ‹è¯•å¤„äºæµ‹è¯•é‡‘å­—å¡”çš„ä¸­å±‚ï¼Œæ—¢è¦ä¿è¯è¦†ç›–å…³é”®åŠŸèƒ½ï¼Œåˆè¦ä¿æŒæµ‹è¯•é€Ÿåº¦ã€‚</p><h2 id="ğŸ“‹-å®Œæ•´æµ‹è¯•æµç¨‹" tabindex="-1"><a class="header-anchor" href="#ğŸ“‹-å®Œæ•´æµ‹è¯•æµç¨‹"><span>ğŸ“‹ å®Œæ•´æµ‹è¯•æµç¨‹</span></a></h2><h3 id="_1-ç¯å¢ƒæ­å»ºä¸é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-ç¯å¢ƒæ­å»ºä¸é…ç½®"><span>1. ç¯å¢ƒæ­å»ºä¸é…ç½®</span></a></h3><p>é¦–å…ˆå®‰è£…å¿…è¦ä¾èµ–å¹¶é…ç½®æµ‹è¯•ç¯å¢ƒï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line"># å®‰è£…æ ¸å¿ƒä¾èµ–</span>
<span class="line">npm install -D vitest @vue/test-utils happy-dom</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ <code>vite.config.ts</code>ä¸­é…ç½®ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">/// &lt;reference types=&quot;vitest&quot; /&gt;</span>
<span class="line">import { defineConfig } from &#39;vite&#39;</span>
<span class="line">import vue from &#39;@vitejs/plugin-vue&#39;</span>
<span class="line"></span>
<span class="line">export default defineConfig({</span>
<span class="line">  plugins: [vue()],</span>
<span class="line">  test: {</span>
<span class="line">    environment: &#39;happy-dom&#39;, // æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒ</span>
<span class="line">    globals: true, // å¯ç”¨å…¨å±€API</span>
<span class="line">    setupFiles: &#39;./tests/setup.ts&#39; // å¯é€‰å…¨å±€é…ç½®</span>
<span class="line">  }</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-æµ‹è¯•æ–‡ä»¶ç»“æ„ç»„ç»‡" tabindex="-1"><a class="header-anchor" href="#_2-æµ‹è¯•æ–‡ä»¶ç»“æ„ç»„ç»‡"><span>2. æµ‹è¯•æ–‡ä»¶ç»“æ„ç»„ç»‡</span></a></h3><p>é‡‡ç”¨æ¸…æ™°çš„æµ‹è¯•æ–‡ä»¶ç»„ç»‡ç»“æ„ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">src/</span>
<span class="line">  components/</span>
<span class="line">    MyComponent.vue</span>
<span class="line">    __tests__/</span>
<span class="line">      MyComponent.test.ts</span>
<span class="line">tests/</span>
<span class="line">  setup.ts          # å…¨å±€æµ‹è¯•é…ç½®</span>
<span class="line">  mocks/            # æ¨¡æ‹Ÿæ•°æ®</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ”-æµ‹è¯•ç¼–å†™é€»è¾‘æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ğŸ”-æµ‹è¯•ç¼–å†™é€»è¾‘æ¨¡å¼"><span>ğŸ” æµ‹è¯•ç¼–å†™é€»è¾‘æ¨¡å¼</span></a></h2><h3 id="aaa-æ¨¡å¼-å‡†å¤‡-æ‰§è¡Œ-æ–­è¨€" tabindex="-1"><a class="header-anchor" href="#aaa-æ¨¡å¼-å‡†å¤‡-æ‰§è¡Œ-æ–­è¨€"><span>AAA æ¨¡å¼ï¼ˆå‡†å¤‡-æ‰§è¡Œ-æ–­è¨€ï¼‰</span></a></h3><p>è¿™æ˜¯æœ€åŸºç¡€çš„æµ‹è¯•ç»“æ„ï¼Œæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½åº”éµå¾ªæ­¤æ¨¡å¼ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">it(&#39;åº”è¯¥æ­£ç¡®æ¸²æŸ“ç»„ä»¶&#39;, () =&gt; {</span>
<span class="line">  // Arrange (å‡†å¤‡)ï¼šè®¾ç½®æµ‹è¯•ç¯å¢ƒ</span>
<span class="line">  const wrapper = mount(MyComponent, {</span>
<span class="line">    props: { title: &#39;æµ‹è¯•æ ‡é¢˜&#39; }</span>
<span class="line">  })</span>
<span class="line">  </span>
<span class="line">  // Act (æ‰§è¡Œ)ï¼šè§¦å‘è¡Œä¸º</span>
<span class="line">  await wrapper.find(&#39;button&#39;).trigger(&#39;click&#39;)</span>
<span class="line">  </span>
<span class="line">  // Assert (æ–­è¨€)ï¼šéªŒè¯ç»“æœ</span>
<span class="line">  expect(wrapper.find(&#39;h1&#39;).text()).toBe(&#39;æµ‹è¯•æ ‡é¢˜&#39;)</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ§ª-æ ¸å¿ƒæµ‹è¯•åœºæ™¯å®ç°" tabindex="-1"><a class="header-anchor" href="#ğŸ§ª-æ ¸å¿ƒæµ‹è¯•åœºæ™¯å®ç°"><span>ğŸ§ª æ ¸å¿ƒæµ‹è¯•åœºæ™¯å®ç°</span></a></h2><h3 id="_1-ç»„ä»¶æ¸²æŸ“æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_1-ç»„ä»¶æ¸²æŸ“æµ‹è¯•"><span>1. ç»„ä»¶æ¸²æŸ“æµ‹è¯•</span></a></h3><p>éªŒè¯ç»„ä»¶æ˜¯å¦èƒ½æ­£ç¡®æ¸²æŸ“å’Œæ˜¾ç¤ºå†…å®¹ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">describe(&#39;ç»„ä»¶æ¸²æŸ“æµ‹è¯•&#39;, () =&gt; {</span>
<span class="line">  it(&#39;åº”è¯¥æ­£ç¡®æ¸²æŸ“é™æ€å†…å®¹&#39;, () =&gt; {</span>
<span class="line">    const wrapper = mount(MyComponent)</span>
<span class="line">    expect(wrapper.find(&#39;.container&#39;).exists()).toBe(true)</span>
<span class="line">    expect(wrapper.text()).toContain(&#39;é¢„æœŸæ–‡æœ¬&#39;)</span>
<span class="line">  })</span>
<span class="line">  </span>
<span class="line">  it(&#39;åº”è¯¥æ ¹æ®propsæ­£ç¡®æ¸²æŸ“&#39;, () =&gt; {</span>
<span class="line">    const wrapper = mount(MyComponent, {</span>
<span class="line">      props: { message: &#39;è‡ªå®šä¹‰æ¶ˆæ¯&#39; }</span>
<span class="line">    })</span>
<span class="line">    expect(wrapper.text()).toContain(&#39;è‡ªå®šä¹‰æ¶ˆæ¯&#39;)</span>
<span class="line">  })</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-ç”¨æˆ·äº¤äº’æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-ç”¨æˆ·äº¤äº’æµ‹è¯•"><span>2. ç”¨æˆ·äº¤äº’æµ‹è¯•</span></a></h3><p>æ¨¡æ‹Ÿç”¨æˆ·æ“ä½œå¹¶éªŒè¯ç»„ä»¶å“åº”ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">describe(&#39;ç”¨æˆ·äº¤äº’æµ‹è¯•&#39;, () =&gt; {</span>
<span class="line">  it(&#39;ç‚¹å‡»æŒ‰é’®åº”è¯¥è§¦å‘äº‹ä»¶&#39;, async () =&gt; {</span>
<span class="line">    const wrapper = mount(MyComponent)</span>
<span class="line">    const button = wrapper.find(&#39;button&#39;)</span>
<span class="line">    </span>
<span class="line">    await button.trigger(&#39;click&#39;)</span>
<span class="line">    </span>
<span class="line">    expect(wrapper.emitted(&#39;click&#39;)).toBeTruthy()</span>
<span class="line">    expect(wrapper.emitted(&#39;click&#39;)[0]).toEqual([/* é¢„æœŸå‚æ•° */])</span>
<span class="line">  })</span>
<span class="line">  </span>
<span class="line">  it(&#39;è¡¨å•è¾“å…¥åº”è¯¥æ›´æ–°æ•°æ®&#39;, async () =&gt; {</span>
<span class="line">    const wrapper = mount(MyComponent)</span>
<span class="line">    const input = wrapper.find(&#39;input&#39;)</span>
<span class="line">    </span>
<span class="line">    await input.setValue(&#39;æ–°å€¼&#39;)</span>
<span class="line">    </span>
<span class="line">    expect(wrapper.vm.inputValue).toBe(&#39;æ–°å€¼&#39;)</span>
<span class="line">  })</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-æ•°æ®å“åº”æ€§æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_3-æ•°æ®å“åº”æ€§æµ‹è¯•"><span>3. æ•°æ®å“åº”æ€§æµ‹è¯•</span></a></h3><p>æµ‹è¯•Vueçš„å“åº”å¼ç³»ç»Ÿï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">it(&#39;æ•°æ®å˜åŒ–åº”è¯¥æ›´æ–°UI&#39;, async () =&gt; {</span>
<span class="line">  const wrapper = mount(MyComponent)</span>
<span class="line">  </span>
<span class="line">  // ç›´æ¥ä¿®æ”¹ç»„ä»¶æ•°æ®</span>
<span class="line">  await wrapper.setData({ count: 5 })</span>
<span class="line">  await nextTick() // ç­‰å¾…DOMæ›´æ–°</span>
<span class="line">  </span>
<span class="line">  expect(wrapper.find(&#39;.count&#39;).text()).toBe(&#39;5&#39;)</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-ç”Ÿå‘½å‘¨æœŸæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_4-ç”Ÿå‘½å‘¨æœŸæµ‹è¯•"><span>4. ç”Ÿå‘½å‘¨æœŸæµ‹è¯•</span></a></h3><p>éªŒè¯ç»„ä»¶æŒ‚è½½ã€æ›´æ–°å’Œå¸è½½è¡Œä¸ºï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">describe(&#39;ç”Ÿå‘½å‘¨æœŸæµ‹è¯•&#39;, () =&gt; {</span>
<span class="line">  it(&#39;æŒ‚è½½æ—¶åº”è¯¥åˆå§‹åŒ–èµ„æº&#39;, () =&gt; {</span>
<span class="line">    const initSpy = vi.spyOn(MyComponent.methods, &#39;init&#39;)</span>
<span class="line">    mount(MyComponent)</span>
<span class="line">    expect(initSpy).toHaveBeenCalled()</span>
<span class="line">  })</span>
<span class="line">  </span>
<span class="line">  it(&#39;å¸è½½æ—¶åº”è¯¥æ¸…ç†èµ„æº&#39;, () =&gt; {</span>
<span class="line">    const disposeSpy = vi.spyOn(MyComponent.methods, &#39;dispose&#39;)</span>
<span class="line">    const wrapper = mount(MyComponent)</span>
<span class="line">    </span>
<span class="line">    wrapper.unmount()</span>
<span class="line">    </span>
<span class="line">    expect(disposeSpy).toHaveBeenCalled()</span>
<span class="line">  })</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ­-æ¨¡æ‹Ÿ-mock-ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#ğŸ­-æ¨¡æ‹Ÿ-mock-ç­–ç•¥"><span>ğŸ­ æ¨¡æ‹Ÿ(Mock)ç­–ç•¥</span></a></h2><h3 id="å¤–éƒ¨ä¾èµ–æ¨¡æ‹Ÿ" tabindex="-1"><a class="header-anchor" href="#å¤–éƒ¨ä¾èµ–æ¨¡æ‹Ÿ"><span>å¤–éƒ¨ä¾èµ–æ¨¡æ‹Ÿ</span></a></h3><p>æ¨¡æ‹ŸAPIè°ƒç”¨ã€ç¬¬ä¸‰æ–¹åº“ç­‰å¤–éƒ¨ä¾èµ–ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">// æ¨¡æ‹ŸAPIæ¨¡å—</span>
<span class="line">vi.mock(&#39;@/api/user&#39;, () =&gt; ({</span>
<span class="line">  fetchUser: vi.fn(() =&gt; Promise.resolve({ name: &#39;æµ‹è¯•ç”¨æˆ·&#39; }))</span>
<span class="line">}))</span>
<span class="line"></span>
<span class="line">// æ¨¡æ‹Ÿæ•´ä¸ªåº“</span>
<span class="line">vi.mock(&#39;echarts&#39;, () =&gt; ({</span>
<span class="line">  init: vi.fn(() =&gt; ({</span>
<span class="line">    setOption: vi.fn(),</span>
<span class="line">    dispose: vi.fn()</span>
<span class="line">  }))</span>
<span class="line">}))</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç»„ä»¶æ¨¡æ‹Ÿ" tabindex="-1"><a class="header-anchor" href="#ç»„ä»¶æ¨¡æ‹Ÿ"><span>ç»„ä»¶æ¨¡æ‹Ÿ</span></a></h3><p>æ¨¡æ‹Ÿå­ç»„ä»¶ä»¥éš”ç¦»æµ‹è¯•ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">const wrapper = mount(ParentComponent, {</span>
<span class="line">  global: {</span>
<span class="line">    stubs: {</span>
<span class="line">      ChildComponent: {</span>
<span class="line">        template: &#39;&lt;div class=&quot;mocked-child&quot;&gt;&lt;/div&gt;&#39;</span>
<span class="line">      }</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“Š-é«˜çº§æµ‹è¯•æŠ€å·§" tabindex="-1"><a class="header-anchor" href="#ğŸ“Š-é«˜çº§æµ‹è¯•æŠ€å·§"><span>ğŸ“Š é«˜çº§æµ‹è¯•æŠ€å·§</span></a></h2><h3 id="_1-å¼‚æ­¥æ“ä½œæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_1-å¼‚æ­¥æ“ä½œæµ‹è¯•"><span>1. å¼‚æ­¥æ“ä½œæµ‹è¯•</span></a></h3><p>å¤„ç†ç»„ä»¶ä¸­çš„å¼‚æ­¥é€»è¾‘ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">it(&#39;åº”è¯¥å¤„ç†å¼‚æ­¥æ•°æ®åŠ è½½&#39;, async () =&gt; {</span>
<span class="line">  const wrapper = mount(AsyncComponent)</span>
<span class="line">  </span>
<span class="line">  // åˆå§‹åŠ è½½çŠ¶æ€</span>
<span class="line">  expect(wrapper.find(&#39;.loading&#39;).exists()).toBe(true)</span>
<span class="line">  </span>
<span class="line">  // ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ</span>
<span class="line">  await flushPromises()</span>
<span class="line">  </span>
<span class="line">  // éªŒè¯åŠ è½½å®Œæˆåçš„çŠ¶æ€</span>
<span class="line">  expect(wrapper.find(&#39;.loading&#39;).exists()).toBe(false)</span>
<span class="line">  expect(wrapper.find(&#39;.content&#39;).exists()).toBe(true)</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-è·¯ç”±å’ŒçŠ¶æ€ç®¡ç†æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_2-è·¯ç”±å’ŒçŠ¶æ€ç®¡ç†æµ‹è¯•"><span>2. è·¯ç”±å’ŒçŠ¶æ€ç®¡ç†æµ‹è¯•</span></a></h3><p>æµ‹è¯•ä¸Vue Routerå’ŒPinia/Vuexé›†æˆçš„ç»„ä»¶ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">it(&#39;åº”è¯¥å¤„ç†è·¯ç”±å¯¼èˆª&#39;, async () =&gt; {</span>
<span class="line">  const router = createRouter({ /* è·¯ç”±é…ç½® */ })</span>
<span class="line">  const pinia = createPinia()</span>
<span class="line">  </span>
<span class="line">  const wrapper = mount(Component, {</span>
<span class="line">    global: {</span>
<span class="line">      plugins: [router, pinia]</span>
<span class="line">    }</span>
<span class="line">  })</span>
<span class="line">  </span>
<span class="line">  await wrapper.find(&#39;a&#39;).trigger(&#39;click&#39;)</span>
<span class="line">  await router.isReady()</span>
<span class="line">  </span>
<span class="line">  expect(wrapper.find(&#39;.new-page&#39;).exists()).toBe(true)</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸš€-æµ‹è¯•ä¼˜åŒ–ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#ğŸš€-æµ‹è¯•ä¼˜åŒ–ç­–ç•¥"><span>ğŸš€ æµ‹è¯•ä¼˜åŒ–ç­–ç•¥</span></a></h2><h3 id="_1-æµ‹è¯•ç»„ç»‡æœ€ä½³å®è·µ" tabindex="-1"><a class="header-anchor" href="#_1-æµ‹è¯•ç»„ç»‡æœ€ä½³å®è·µ"><span>1. æµ‹è¯•ç»„ç»‡æœ€ä½³å®è·µ</span></a></h3><ul><li><strong>å•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ªæµ‹è¯•åªéªŒè¯ä¸€ä¸ªåŠŸèƒ½ç‚¹</li><li><strong>æè¿°æ€§å‘½å</strong>ï¼šæµ‹è¯•åç§°åº”æ¸…æ™°æè¿°æµ‹è¯•æ„å›¾</li><li><strong>é¿å…æµ‹è¯•å®ç°ç»†èŠ‚</strong>ï¼šå…³æ³¨è¡Œä¸ºè€Œéå†…éƒ¨å®ç°</li></ul><h3 id="_2-æ€§èƒ½ä¼˜åŒ–é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-æ€§èƒ½ä¼˜åŒ–é…ç½®"><span>2. æ€§èƒ½ä¼˜åŒ–é…ç½®</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">// vitest.config.ts</span>
<span class="line">export default defineConfig({</span>
<span class="line">  test: {</span>
<span class="line">    threads: true,     // å¹¶è¡Œæµ‹è¯•</span>
<span class="line">    cache: true,       // æµ‹è¯•ç¼“å­˜</span>
<span class="line">    isolate: true,      // æµ‹è¯•éš”ç¦»</span>
<span class="line">  }</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ“ˆ-æµ‹è¯•è¦†ç›–ç‡ä¸cié›†æˆ" tabindex="-1"><a class="header-anchor" href="#ğŸ“ˆ-æµ‹è¯•è¦†ç›–ç‡ä¸cié›†æˆ"><span>ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡ä¸CIé›†æˆ</span></a></h2><h3 id="è¦†ç›–ç‡é…ç½®" tabindex="-1"><a class="header-anchor" href="#è¦†ç›–ç‡é…ç½®"><span>è¦†ç›–ç‡é…ç½®</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">// é…ç½®è¦†ç›–ç‡</span>
<span class="line">test: {</span>
<span class="line">  coverage: {</span>
<span class="line">    provider: &#39;istanbul&#39;,</span>
<span class="line">    reporter: [&#39;text&#39;, &#39;html&#39;, &#39;json&#39;],</span>
<span class="line">    thresholds: {</span>
<span class="line">      lines: 80,</span>
<span class="line">      functions: 80,</span>
<span class="line">      branches: 80,</span>
<span class="line">      statements: 80</span>
<span class="line">    }</span>
<span class="line">  }</span>
<span class="line">}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ci-cdé›†æˆ" tabindex="-1"><a class="header-anchor" href="#ci-cdé›†æˆ"><span>CI/CDé›†æˆ</span></a></h3><p>åœ¨GitHub Actionsä¸­é›†æˆæµ‹è¯•ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code><span class="line">name: Test</span>
<span class="line">on: [push, pull_request]</span>
<span class="line">jobs:</span>
<span class="line">  test:</span>
<span class="line">    runs-on: ubuntu-latest</span>
<span class="line">    steps:</span>
<span class="line">      - uses: actions/checkout@v3</span>
<span class="line">      - uses: actions/setup-node@v3</span>
<span class="line">      - run: npm ci</span>
<span class="line">      - run: npm test</span>
<span class="line">      - run: npm run test:coverage</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ğŸ’¡-å®ç”¨å»ºè®®æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡-å®ç”¨å»ºè®®æ€»ç»“"><span>ğŸ’¡ å®ç”¨å»ºè®®æ€»ç»“</span></a></h2><ol><li><strong>ä»ç®€å•å¼€å§‹</strong>ï¼šå…ˆæµ‹è¯•æ ¸å¿ƒåŠŸèƒ½ï¼Œå†é€æ­¥å¢åŠ å¤æ‚åº¦</li><li><strong>æµ‹è¯•ç”¨æˆ·è¡Œä¸º</strong>ï¼šæ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œæµç¨‹</li><li><strong>ä¿æŒæµ‹è¯•ç‹¬ç«‹</strong>ï¼šæ¯ä¸ªæµ‹è¯•ä¸åº”è¯¥ä¾èµ–å…¶ä»–æµ‹è¯•çš„çŠ¶æ€</li><li><strong>å®šæœŸé‡æ„æµ‹è¯•</strong>ï¼šéšç€ç»„ä»¶æ¼”è¿›ï¼ŒåŒæ­¥æ›´æ–°æµ‹è¯•ä»£ç </li></ol>`,210)])])}const i=s(e,[["render",c]]),u=JSON.parse(`{"path":"/posts/vuelearning/vitest.html","title":"Vitestå…¥é—¨","lang":"zh-CN","frontmatter":{"date":"2025-11-06T00:00:00.000Z","category":["è¯´æ˜æ–‡æ¡£"],"tag":["Vitest"]},"headers":[{"level":2,"title":"åŸºæœ¬æµ‹è¯•","slug":"åŸºæœ¬æµ‹è¯•","link":"#åŸºæœ¬æµ‹è¯•","children":[{"level":3,"title":"ğŸ“ ç†è§£æµ‹è¯•æ–‡ä»¶çš„åŸºæœ¬ç»“æ„","slug":"ğŸ“-ç†è§£æµ‹è¯•æ–‡ä»¶çš„åŸºæœ¬ç»“æ„","link":"#ğŸ“-ç†è§£æµ‹è¯•æ–‡ä»¶çš„åŸºæœ¬ç»“æ„","children":[]},{"level":3,"title":"ğŸ¯ æŒæ¡æ ¸å¿ƒæ–­è¨€æ–¹æ³•","slug":"ğŸ¯-æŒæ¡æ ¸å¿ƒæ–­è¨€æ–¹æ³•","link":"#ğŸ¯-æŒæ¡æ ¸å¿ƒæ–­è¨€æ–¹æ³•","children":[]},{"level":3,"title":"ğŸ”§ ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ç»„ç»‡æµ‹è¯•","slug":"ğŸ”§-ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ç»„ç»‡æµ‹è¯•","link":"#ğŸ”§-ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­ç»„ç»‡æµ‹è¯•","children":[]},{"level":3,"title":"ğŸ­ æ¨¡æ‹Ÿï¼ˆMockï¼‰å¤–éƒ¨ä¾èµ–","slug":"ğŸ­-æ¨¡æ‹Ÿ-mock-å¤–éƒ¨ä¾èµ–","link":"#ğŸ­-æ¨¡æ‹Ÿ-mock-å¤–éƒ¨ä¾èµ–","children":[]},{"level":3,"title":"ğŸ’¡ æµ‹è¯• Vue å•æ–‡ä»¶ç»„ä»¶ (SFC)","slug":"ğŸ’¡-æµ‹è¯•-vue-å•æ–‡ä»¶ç»„ä»¶-sfc","link":"#ğŸ’¡-æµ‹è¯•-vue-å•æ–‡ä»¶ç»„ä»¶-sfc","children":[]},{"level":3,"title":"ğŸš€ å®è·µå·¥ä½œæµä¸å»ºè®®","slug":"ğŸš€-å®è·µå·¥ä½œæµä¸å»ºè®®","link":"#ğŸš€-å®è·µå·¥ä½œæµä¸å»ºè®®","children":[]}]},{"level":2,"title":"ç¤ºä¾‹æ–‡ä»¶","slug":"ç¤ºä¾‹æ–‡ä»¶","link":"#ç¤ºä¾‹æ–‡ä»¶","children":[]},{"level":2,"title":"Config","slug":"config","link":"#config","children":[{"level":3,"title":"ğŸ’» ç¯å¢ƒä¸å…¨å±€è®¾ç½®","slug":"ğŸ’»-ç¯å¢ƒä¸å…¨å±€è®¾ç½®","link":"#ğŸ’»-ç¯å¢ƒä¸å…¨å±€è®¾ç½®","children":[]},{"level":3,"title":"ğŸ” æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œæ§åˆ¶","slug":"ğŸ”-æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œæ§åˆ¶","link":"#ğŸ”-æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œæ§åˆ¶","children":[]},{"level":3,"title":"ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Š","slug":"ğŸ“Š-è¦†ç›–ç‡æŠ¥å‘Š","link":"#ğŸ“Š-è¦†ç›–ç‡æŠ¥å‘Š","children":[]},{"level":3,"title":"ğŸ› ï¸ é«˜çº§ä¸æ¡†æ¶é›†æˆé…ç½®","slug":"ğŸ› ï¸-é«˜çº§ä¸æ¡†æ¶é›†æˆé…ç½®","link":"#ğŸ› ï¸-é«˜çº§ä¸æ¡†æ¶é›†æˆé…ç½®","children":[]}]},{"level":2,"title":"TestApi","slug":"testapi","link":"#testapi","children":[{"level":3,"title":"ğŸ”‘åŒºåˆ«è”ç³»","slug":"ğŸ”‘åŒºåˆ«è”ç³»","link":"#ğŸ”‘åŒºåˆ«è”ç³»","children":[]},{"level":3,"title":"ğŸ’¡ æ ¸å¿ƒ API è¯¦è§£ä¸ä½¿ç”¨æŠ€å·§","slug":"ğŸ’¡-æ ¸å¿ƒ-api-è¯¦è§£ä¸ä½¿ç”¨æŠ€å·§","link":"#ğŸ’¡-æ ¸å¿ƒ-api-è¯¦è§£ä¸ä½¿ç”¨æŠ€å·§","children":[]},{"level":3,"title":"ğŸ’ å®è·µå»ºè®®","slug":"ğŸ’-å®è·µå»ºè®®","link":"#ğŸ’-å®è·µå»ºè®®","children":[]}]},{"level":2,"title":"MockApi","slug":"mockapi","link":"#mockapi","children":[{"level":3,"title":"ğŸ“Š Vitest Mock API æ¦‚è§ˆ","slug":"ğŸ“Š-vitest-mock-api-æ¦‚è§ˆ","link":"#ğŸ“Š-vitest-mock-api-æ¦‚è§ˆ","children":[]},{"level":3,"title":"ğŸ”§ æ ¸å¿ƒ Mock API è¯¦è§£","slug":"ğŸ”§-æ ¸å¿ƒ-mock-api-è¯¦è§£","link":"#ğŸ”§-æ ¸å¿ƒ-mock-api-è¯¦è§£","children":[]},{"level":3,"title":"ğŸ’¡ æœ€ä½³å®è·µå»ºè®®","slug":"ğŸ’¡-æœ€ä½³å®è·µå»ºè®®","link":"#ğŸ’¡-æœ€ä½³å®è·µå»ºè®®","children":[]},{"level":3,"title":"Puls:å¯è·Ÿè¸ª","slug":"puls-å¯è·Ÿè¸ª","link":"#puls-å¯è·Ÿè¸ª","children":[]}]},{"level":2,"title":"è¦†ç›–ç‡æŠ¥å‘Š","slug":"è¦†ç›–ç‡æŠ¥å‘Š","link":"#è¦†ç›–ç‡æŠ¥å‘Š","children":[{"level":3,"title":"ğŸ’» ç¯å¢ƒä¸å…¨å±€è®¾ç½®","slug":"ğŸ’»-ç¯å¢ƒä¸å…¨å±€è®¾ç½®-1","link":"#ğŸ’»-ç¯å¢ƒä¸å…¨å±€è®¾ç½®-1","children":[]},{"level":3,"title":"ğŸ” æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œæ§åˆ¶","slug":"ğŸ”-æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œæ§åˆ¶-1","link":"#ğŸ”-æµ‹è¯•åŒ¹é…ä¸æ‰§è¡Œæ§åˆ¶-1","children":[]},{"level":3,"title":"ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Š","slug":"ğŸ“Š-è¦†ç›–ç‡æŠ¥å‘Š-1","link":"#ğŸ“Š-è¦†ç›–ç‡æŠ¥å‘Š-1","children":[]},{"level":3,"title":"ğŸ› ï¸ é«˜çº§ä¸æ¡†æ¶é›†æˆé…ç½®","slug":"ğŸ› ï¸-é«˜çº§ä¸æ¡†æ¶é›†æˆé…ç½®-1","link":"#ğŸ› ï¸-é«˜çº§ä¸æ¡†æ¶é›†æˆé…ç½®-1","children":[]}]},{"level":2,"title":"ğŸ¯ æµ‹è¯•æ ¸å¿ƒæ€æƒ³","slug":"ğŸ¯-æµ‹è¯•æ ¸å¿ƒæ€æƒ³","link":"#ğŸ¯-æµ‹è¯•æ ¸å¿ƒæ€æƒ³","children":[{"level":3,"title":"æµ‹è¯•é‡‘å­—å¡”åŸåˆ™","slug":"æµ‹è¯•é‡‘å­—å¡”åŸåˆ™","link":"#æµ‹è¯•é‡‘å­—å¡”åŸåˆ™","children":[]}]},{"level":2,"title":"ğŸ“‹ å®Œæ•´æµ‹è¯•æµç¨‹","slug":"ğŸ“‹-å®Œæ•´æµ‹è¯•æµç¨‹","link":"#ğŸ“‹-å®Œæ•´æµ‹è¯•æµç¨‹","children":[{"level":3,"title":"1. ç¯å¢ƒæ­å»ºä¸é…ç½®","slug":"_1-ç¯å¢ƒæ­å»ºä¸é…ç½®","link":"#_1-ç¯å¢ƒæ­å»ºä¸é…ç½®","children":[]},{"level":3,"title":"2. æµ‹è¯•æ–‡ä»¶ç»“æ„ç»„ç»‡","slug":"_2-æµ‹è¯•æ–‡ä»¶ç»“æ„ç»„ç»‡","link":"#_2-æµ‹è¯•æ–‡ä»¶ç»“æ„ç»„ç»‡","children":[]}]},{"level":2,"title":"ğŸ” æµ‹è¯•ç¼–å†™é€»è¾‘æ¨¡å¼","slug":"ğŸ”-æµ‹è¯•ç¼–å†™é€»è¾‘æ¨¡å¼","link":"#ğŸ”-æµ‹è¯•ç¼–å†™é€»è¾‘æ¨¡å¼","children":[{"level":3,"title":"AAA æ¨¡å¼ï¼ˆå‡†å¤‡-æ‰§è¡Œ-æ–­è¨€ï¼‰","slug":"aaa-æ¨¡å¼-å‡†å¤‡-æ‰§è¡Œ-æ–­è¨€","link":"#aaa-æ¨¡å¼-å‡†å¤‡-æ‰§è¡Œ-æ–­è¨€","children":[]}]},{"level":2,"title":"ğŸ§ª æ ¸å¿ƒæµ‹è¯•åœºæ™¯å®ç°","slug":"ğŸ§ª-æ ¸å¿ƒæµ‹è¯•åœºæ™¯å®ç°","link":"#ğŸ§ª-æ ¸å¿ƒæµ‹è¯•åœºæ™¯å®ç°","children":[{"level":3,"title":"1. ç»„ä»¶æ¸²æŸ“æµ‹è¯•","slug":"_1-ç»„ä»¶æ¸²æŸ“æµ‹è¯•","link":"#_1-ç»„ä»¶æ¸²æŸ“æµ‹è¯•","children":[]},{"level":3,"title":"2. ç”¨æˆ·äº¤äº’æµ‹è¯•","slug":"_2-ç”¨æˆ·äº¤äº’æµ‹è¯•","link":"#_2-ç”¨æˆ·äº¤äº’æµ‹è¯•","children":[]},{"level":3,"title":"3. æ•°æ®å“åº”æ€§æµ‹è¯•","slug":"_3-æ•°æ®å“åº”æ€§æµ‹è¯•","link":"#_3-æ•°æ®å“åº”æ€§æµ‹è¯•","children":[]},{"level":3,"title":"4. ç”Ÿå‘½å‘¨æœŸæµ‹è¯•","slug":"_4-ç”Ÿå‘½å‘¨æœŸæµ‹è¯•","link":"#_4-ç”Ÿå‘½å‘¨æœŸæµ‹è¯•","children":[]}]},{"level":2,"title":"ğŸ­ æ¨¡æ‹Ÿ(Mock)ç­–ç•¥","slug":"ğŸ­-æ¨¡æ‹Ÿ-mock-ç­–ç•¥","link":"#ğŸ­-æ¨¡æ‹Ÿ-mock-ç­–ç•¥","children":[{"level":3,"title":"å¤–éƒ¨ä¾èµ–æ¨¡æ‹Ÿ","slug":"å¤–éƒ¨ä¾èµ–æ¨¡æ‹Ÿ","link":"#å¤–éƒ¨ä¾èµ–æ¨¡æ‹Ÿ","children":[]},{"level":3,"title":"ç»„ä»¶æ¨¡æ‹Ÿ","slug":"ç»„ä»¶æ¨¡æ‹Ÿ","link":"#ç»„ä»¶æ¨¡æ‹Ÿ","children":[]}]},{"level":2,"title":"ğŸ“Š é«˜çº§æµ‹è¯•æŠ€å·§","slug":"ğŸ“Š-é«˜çº§æµ‹è¯•æŠ€å·§","link":"#ğŸ“Š-é«˜çº§æµ‹è¯•æŠ€å·§","children":[{"level":3,"title":"1. å¼‚æ­¥æ“ä½œæµ‹è¯•","slug":"_1-å¼‚æ­¥æ“ä½œæµ‹è¯•","link":"#_1-å¼‚æ­¥æ“ä½œæµ‹è¯•","children":[]},{"level":3,"title":"2. è·¯ç”±å’ŒçŠ¶æ€ç®¡ç†æµ‹è¯•","slug":"_2-è·¯ç”±å’ŒçŠ¶æ€ç®¡ç†æµ‹è¯•","link":"#_2-è·¯ç”±å’ŒçŠ¶æ€ç®¡ç†æµ‹è¯•","children":[]}]},{"level":2,"title":"ğŸš€ æµ‹è¯•ä¼˜åŒ–ç­–ç•¥","slug":"ğŸš€-æµ‹è¯•ä¼˜åŒ–ç­–ç•¥","link":"#ğŸš€-æµ‹è¯•ä¼˜åŒ–ç­–ç•¥","children":[{"level":3,"title":"1. æµ‹è¯•ç»„ç»‡æœ€ä½³å®è·µ","slug":"_1-æµ‹è¯•ç»„ç»‡æœ€ä½³å®è·µ","link":"#_1-æµ‹è¯•ç»„ç»‡æœ€ä½³å®è·µ","children":[]},{"level":3,"title":"2. æ€§èƒ½ä¼˜åŒ–é…ç½®","slug":"_2-æ€§èƒ½ä¼˜åŒ–é…ç½®","link":"#_2-æ€§èƒ½ä¼˜åŒ–é…ç½®","children":[]}]},{"level":2,"title":"ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡ä¸CIé›†æˆ","slug":"ğŸ“ˆ-æµ‹è¯•è¦†ç›–ç‡ä¸cié›†æˆ","link":"#ğŸ“ˆ-æµ‹è¯•è¦†ç›–ç‡ä¸cié›†æˆ","children":[{"level":3,"title":"è¦†ç›–ç‡é…ç½®","slug":"è¦†ç›–ç‡é…ç½®","link":"#è¦†ç›–ç‡é…ç½®","children":[]},{"level":3,"title":"CI/CDé›†æˆ","slug":"ci-cdé›†æˆ","link":"#ci-cdé›†æˆ","children":[]}]},{"level":2,"title":"ğŸ’¡ å®ç”¨å»ºè®®æ€»ç»“","slug":"ğŸ’¡-å®ç”¨å»ºè®®æ€»ç»“","link":"#ğŸ’¡-å®ç”¨å»ºè®®æ€»ç»“","children":[]}],"git":{"updatedTime":1765250440000,"contributors":[{"name":"ksldnasx","username":"ksldnasx","email":"wh8261408@126.com","commits":7,"url":"https://github.com/ksldnasx"}],"changelog":[{"hash":"acd93ed23f26117dad056c26ee821ccbe6fb6c2e","time":1765250440000,"email":"wh8261408@126.com","author":"ksldnasx","message":"style:å¼€å§‹é¡µæ ·å¼å¤§æ”¹ fix:é“¾æ¥æ­£ç¡®ä¿®æ”¹"},{"hash":"a0089923dda5b0a1e568fce8d29533128e78ce23","time":1765244359000,"email":"wh8261408@126.com","author":"ksldnasx","message":"fix:å„ç±»æ–‡ä»¶å¸ƒå±€"},{"hash":"82986032106d89195676536db2e6efd6060346b6","time":1764041784000,"email":"wh8261408@126.com","author":"ksldnasx","message":"feat:æ–°å¢sseç›¸å…³é¡µé¢ã€‚fix:get-startedé¡µé¢ä¿®æ”¹"},{"hash":"79c4e1ccc789b24db78f624de0a6e106820d8350","time":1762509180000,"email":"wh8261408@126.com","author":"ksldnasx","message":"add:ç¬¬äºŒå‘¨å®ä¹ æ€»ç»“"},{"hash":"90c6e6db7d17c65fd89a9a96a137199210d766fb","time":1762417013000,"email":"wh8261408@126.com","author":"ksldnasx","message":"æ–°å¢æœç´¢æ’ä»¶"},{"hash":"6d6aa81d85891a959019fa483a1268de122565f8","time":1762414191000,"email":"wh8261408@126.com","author":"ksldnasx","message":"better coverage"},{"hash":"777080f9cb61625063573bffd7eb8f506620dc39","time":1762400469000,"email":"wh8261408@126.com","author":"ksldnasx","message":"init"}]},"filePathRelative":"posts/vuelearning/vitest.md","excerpt":"\\n<h2>åŸºæœ¬æµ‹è¯•</h2>\\n<h3>ğŸ“ ç†è§£æµ‹è¯•æ–‡ä»¶çš„åŸºæœ¬ç»“æ„</h3>\\n<p>ä¸€ä¸ª Vitest æµ‹è¯•æ–‡ä»¶é€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒä»¬å…±åŒæ„æˆäº†æµ‹è¯•çš„åŸºæœ¬éª¨æ¶ï¼š</p>\\n<table>\\n<thead>\\n<tr>\\n<th>ç»„æˆéƒ¨åˆ†</th>\\n<th>æè¿°</th>\\n<th>ä»£ç ç¤ºä¾‹</th>\\n</tr>\\n</thead>\\n<tbody>\\n<tr>\\n<td><strong>å¯¼å…¥è¯­å¥</strong></td>\\n<td>å¼•å…¥æµ‹è¯•æ¡†æ¶çš„åŠŸèƒ½å’Œå¾…æµ‹è¯•å¯¹è±¡ã€‚</td>\\n<td><code>import { describe, it, expect } from 'vitest';\`\`import { sum } from './math';</code></td>\\n</tr>\\n<tr>\\n<td><strong>æµ‹è¯•å¥—ä»¶ (Test Suite)</strong></td>\\n<td>ä½¿ç”¨ <code>describe</code>å°†ä¸€ç³»åˆ—ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹ç»„ç»‡åœ¨ä¸€èµ·ã€‚</td>\\n<td><code>describe('æ•°å­¦å·¥å…·å‡½æ•°', () =&gt; { ... });</code></td>\\n</tr>\\n<tr>\\n<td><strong>æµ‹è¯•ç”¨ä¾‹ (Test Case)</strong></td>\\n<td>ä½¿ç”¨ <code>it</code>æˆ– <code>test</code>å®šä¹‰å•ä¸ªå…·ä½“çš„æµ‹è¯•åœºæ™¯ã€‚</td>\\n<td><code>it('åº”è¯¥èƒ½æ­£ç¡®è®¡ç®—ä¸¤ä¸ªæ•°å­—çš„å’Œ', () =&gt; { ... });</code></td>\\n</tr>\\n<tr>\\n<td><strong>æ–­è¨€ (Assertion)</strong></td>\\n<td>ä½¿ç”¨ <code>expect</code>æ¥éªŒè¯ä»£ç çš„è¡Œä¸ºå’Œè¾“å‡ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</td>\\n<td><code>expect(sum(1, 2)).toBe(3);</code></td>\\n</tr>\\n</tbody>\\n</table>"}`);export{i as comp,u as data};
